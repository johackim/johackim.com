{"pageProps":{"source":"<link rel=\"preload\" as=\"image\" href=\"https://i.imgur.com/HPFrm3m.png\"/><link rel=\"preload\" as=\"image\" href=\"https://i.imgur.com/0BtefaD.png\"/><div class=\"space-y-4 whitespace-normal *:first:mt-0 *:last:mb-0\"><p>Après plusieurs semaines de recherches et de tests, je souhaite partager avec vous ce guide d&#x27;installation d&#x27;un homelab conçu uniquement avec des logiciels open-source afin de vous permettre d&#x27;héberger vos sites internet à la maison !</p><p>PS: J&#x27;envisage par la suite de créer une solution <strong>homelab</strong> <strong>all-in-one</strong> et <strong>plug&#x27;n play</strong> afin de permettre aux néophytes d&#x27;installer eux-mêmes leur datacenter chez eux sans connaissances particulières. Si vous êtes intéressé par ce projet, n&#x27;hésitez pas à renseigner votre adresse mail <a class=\"\" href=\"/newsletter\">sur ce lien</a> afin d&#x27;être informé de sa sortie.</p><p>Pour le moment voilà à quoi ressemble mon infrastructure maison :</p><p><img src=\"https://i.imgur.com/HPFrm3m.png\" alt=\"Infrastructure\"/></p><p><strong>NOTE</strong> : Je suis chez orange (Sosh plus précisément) et ma livebox ne gère pas le <strong>bridge</strong>, je ne peux donc pas utilisé <strong>pfsense</strong> en tant que routeur, firewall et serveur DHCP. Et je n&#x27;ai pas non plus la possibilité d&#x27;obtenir une <strong>IP publique fixe</strong>. Je referai un article sur <strong>pfsense</strong> lorsque j&#x27;aurai changé de FAI...</p><h2>Prérequis</h2><ul>\n<li>Un PC avec une connexion internet fera l&#x27;affaire. (il existe aussi <a class=\"\" target=\"_blank\" href=\"https://intel.com/content/us/en/products/boards-kits/nuc.html\">les mini PC NUC de Intel</a> qui ont l&#x27;air pas mal).</li>\n</ul><p>Pour ma part j&#x27;ai utilisé mon vieux <a class=\"\" target=\"_blank\" href=\"https://framapic.org/QaBdvkTz4snV/OIbeUeFPEL2I.jpg\">Sony VAIO VPCF21Z1E</a> en tant que <strong>Serveur Bare-Metal</strong> sur lequel j&#x27;ai installé <strong>proxmox</strong> comme <strong>hyperviseur</strong>. J&#x27;y ai démarré une VM (machine virtuelle) avec le reverse proxy <strong>traefik</strong> pour pouvoir router le trafic entrant sur les VMs correspondantes. Je peux désormais démarrer autant de VMs que je veux dans la limite des capacités de mon ordinateur. Dans le cas où les limites sont proches d&#x27;être dépassé, proxmox permet de faire du clustering et donne la possibilité de lier d&#x27;autres équipements.</p><p>Voici selon moi les avantages et désavantages de l&#x27;utilisation d&#x27;un homelab par rapport à une solution cloud:</p><h2>Les avantages</h2><ul>\n<li>Protection de la vie privée</li>\n<li>Économies d&#x27;argent</li>\n<li>Garder le contrôle de ses données</li>\n<li>Pas de restriction ni de dépendance avec un service tiers</li>\n<li>Impact écologique moindre</li>\n<li>Décentraliser internet</li>\n</ul><h2>Les désavantages</h2><ul>\n<li>Le bon fonctionnement de votre homelab dépendra de la qualité du réseau / débit de votre connexion internet.</li>\n<li>Votre PC doit rester allumé 24h/24</li>\n<li>Pas de support, vous êtes seul en tant qu&#x27;administrateur système (if you break it, you fix it)</li>\n<li>Vous disposez généralement d&#x27;une seule adresse IP publique qui n&#x27;est pas toujours statique.</li>\n</ul><p>Si comme moi vous êtes curieux, bidouilleur, sensible au sujet de la vie privée et que vous souhaitez vous passer des fournisseurs cloud traditionnels comme AWS, OVH, Digital Ocean, Scaleway, Google Cloud Platform et j&#x27;en passe alors vous êtes au bon endroit !</p><h2>Installation de Proxmox</h2><p>Dans un premier temps, vous devez télécharger et copier le fichier .iso depuis le <a class=\"\" target=\"_blank\" href=\"https://proxmox.com/en/downloads/category/iso-images-pve\">site officiel</a> sur une clé USB. De mon côté, j&#x27;utilise <a class=\"\" target=\"_blank\" href=\"https://etcher.io/\">etcher</a> pour créer une clé USB bootable.</p><p>Une fois bootée sur votre ordinateur qui fera office de serveur, l&#x27;installation commence :</p><p>Selectionnez le disque dur de destination (<code>/dev/sda</code> dans mon cas).</p><p>Selectionnez votre timezone et la langue de votre clavier.</p><p>Configurer les paramètres réseau</p><p><img src=\"https://i.imgur.com/0BtefaD.png\" alt=\"proxmox configuration réseau\"/></p><ul>\n<li>Reboot</li>\n</ul><p>L&#x27;installation est déjà terminée. Vous pouvez accéder à la très jolie UI de proxmox via <a class=\"\" target=\"_blank\" href=\"https://192.168.1.50:8006\">https://192.168.1.50:8006</a> avec l&#x27;identifiant <strong>root</strong> et <strong>votre mot de passe</strong>.</p><p>Vous pouvez déjà créer des VPS (serveurs privés virtuels) à la demande gratuitement et chez vous !</p><p><strong>Bonus</strong>: proxmox fournit un <strong>catalogue de template</strong> avec tout plein de distributions et services à démarrer en quelques clics (gitlab, etherpad, jenkins, piwik, debian, ubuntu, arch, centos etc...). La partie <strong>Backup</strong> vous permet de planifier la sauvegarde de vos VMs sous forme de snapshots.</p><h2>Reverse proxy (traefik) et let&#x27;s encrypt</h2><p>Je dispose d&#x27;une seule adresse IP publique et les services web que je compte déployer sont répartis sur plusieurs machines virtuelles. <strong>traefik</strong> va router le trafic web entrant sur les différentes VMs.</p><p>On créer une VM <strong>traefik</strong> basé sur <strong>debian</strong> puis on autorise l&#x27;accès aux ports <strong>80</strong> et <strong>443</strong> en ajoutant deux règles de <strong>port forwarding</strong> sur notre box internet en direction de notre nouvelle VM.</p><p>L&#x27;installation de <strong>traefik</strong> est très simple, un simple fichier binaire en go à <a class=\"\" target=\"_blank\" href=\"https://github.com/containous/traefik/releases\">télécharger</a> et exécuter.</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">wget -O /usr/local/bin/traefik https://github.com/containous/traefik/releases/download/v1.4.0-rc4/traefik_linux-amd64\nchmod + /usr/local/bin/traefik\n</code></pre></div><p>Voilà à quoi ressemble ma configuration pour accéder au blog sur lequel vous vous trouvez actuellement :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-toml\"># traefik.toml\n\ndefaultEntryPoints = [&quot;http&quot;, &quot;https&quot;]\n\n[entryPoints]\n\n  [entryPoints.http]\n  address = &quot;:80&quot;\n    [entryPoints.http.redirect]\n    entryPoint = &quot;https&quot;\n  [entryPoints.https]\n  address = &quot;:443&quot;\n    [entryPoints.https.tls]\n\n[acme]\n\nemail = &quot;contact@johackim.com&quot;\nstorage = &quot;acme.json&quot;\nentryPoint = &quot;https&quot;\nonDemand = true\n\n[[acme.domains]]\n  main = &quot;johackim.com&quot;\n\n[file]\n\n[backends]\n  [backends.blog]\n    [backends.blog.servers.server]\n    url = &quot;http://192.168.1.5:80&quot;\n\n[frontends]\n  [frontends.blog]\n  passHostHeader = true\n  entrypoints = [&quot;http&quot;, &quot;https&quot;]\n  backend = &quot;blog&quot;\n    [frontends.blog.routes.route]\n    rule = &quot;Host:johackim.com&quot;\n</code></pre></div><p>Une simple commande permet de démarrer traefik : <code>traefik -c traefik.toml</code></p><p>L&#x27;avantage de cette configuration c&#x27;est qu&#x27;elle permet d&#x27;automatiser la génération de certificats <strong>let&#x27;s encrypt</strong>.</p><h2>Configuration de DYNDNS</h2><p>Dans le cas où votre FAI ne vous donne pas la possibilité de disposer d&#x27;une IP statique il existe plusieurs méthodes, j&#x27;en connais actuellement deux, la première fonctionne avec <strong>ddclient</strong>:</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">DEBIAN_FRONTEND=noninteractive apt-get install -y ddclient\n</code></pre></div><p>Voici un exemple de configuration <strong>ddclient</strong> relié à <strong>OVH</strong> :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-conf\"># /etc/ddclient.conf\n\nprotocol=dyndns2\nuse=web, web=checkip.dyndns.com\nserver=ovh.com\nlogin=YOUR_LOGIN\npassword=YOUR_PASSWORD\njohackim.com\n</code></pre></div><p>La seconde méthode fonctionne avec un simple script shell <strong>dyndns.sh:</strong></p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">#!/bin/bash\n\nDYNHOST_USER=&quot;MY_LOGIN&quot;\nDYNHOST_PASSWD=&quot;MY_PASSWORD&quot;\nDYNHOST_DOMAINS=(mydomain.com mydomain2.com)\nOVH_URL=&quot;https://ovh.com/nic/update?system=dyndns&quot;\n\nfor DYNHOST_DOMAIN in ${DYNHOST_DOMAINS[@]}; do\n    curl --user &quot;$DYNHOST_USER:$DYNHOST_PASSWD&quot; &quot;${OVH_URL}&amp;hostname=${DYNHOST_DOMAIN}&quot;\ndone\n\nexit $?\n</code></pre></div><p>Sans oublié de configurer une tâche cron:</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-cron\">*/10 * * * * bash /usr/local/bin/dyndns.sh\n</code></pre></div><p>Dans les deux cas il faudra vous créer un identifiant dans la partie <strong>DynHOST</strong> de votre nom de domaine chez OVH.</p><h2>Contourner le loopback de la Livebox</h2><p>Pour ceux qui disposent une livebox et qui aimeraient accéder à leurs services depuis leur réseau local sans être redirigé sur la page d&#x27;accueil de la livebox je les invite à se rendre sur <a class=\"\" target=\"_blank\" href=\"https://blog.cagedmonster.net/contourner-le-loopback-de-la-livebox/\">cet article</a>.</p><h2>Conclusion</h2><p>Bon, ce n’est pas encore un AWS maison, mais pour ceux qui rêvent de pouvoir lancer des VPS simplement et automatiser leurs sauvegardes avec uniquement des logiciels open-source c&#x27;est déjà un très bon début.</p><p>J&#x27;ai migré toute mon infrastructure OVH chez moi et je dois avouer que c&#x27;est très plaisant ! Je peux augmenté la RAM, CPU et la taille des disques de mes VMs très facilement grâce à proxmox et à moindre cout.</p><p>J&#x27;utilise cette infrastructure maison pour démarrer tous mes services, à savoir Taiga, Jenkins, Rocket.Chat, Metabase, Sentry, Gogs, Zabbix, Searx, Wallabag, Piwik et le blog que vous lisez actuellement</p><p>Pour l&#x27;aspect sécurité, à vous d&#x27;installer et paramétrer vos firewalls, IPS, hardening ect...</p><p>Voilà ! Si vous avez des questions, suggestions ou améliorations à apporter pour faciliter le processus d&#x27;installation ou autre, n&#x27;hésitez pas à les soumettre dans les commentaires !</p><hr/><p>Références :</p><ul>\n<li><a class=\"\" target=\"_blank\" href=\"https://blog.zwindler.fr/2017/07/11/deploiment-de-proxmox-ve-5-sur-un-serveur-dedie-part-1/\">Déploiement de proxmox ve 5 sur un serveur dédié</a></li>\n<li><a class=\"\" target=\"_blank\" href=\"https://reddit.com/r/homelab/\">https://reddit.com/r/homelab/</a></li>\n</ul></div>","isIndex":false,"file":"Homelab.md","fileName":"Homelab","title":"Comment créer son datacenter maison (homelab) ?","comments":true,"permalink":"comment-creer-son-datacenter-maison","datePublished":"2017-10-27T08:24","dateUpdated":"2017-10-27T08:24","description":"Voici un guide d'installation d'un homelab conçu uniquement avec des logiciels open-source afin de vous permettre d'héberger vos sites internet à la maison !","publish":true,"rss":true,"aliases":""},"__N_SSG":true}