{"pageProps":{"source":"<div class=\"space-y-4 whitespace-normal *:first:mt-0 *:last:mb-0\"><p>Voici comment créer un système d&#x27;authentification <a title=\"Note bientôt disponible\" class=\"!no-underline border-b-2 border-dotted border-cyan-700\" href=\"/soon?title=OAuth\">OAuth</a> avec Spotify.</p>\n<p>Commencez par <a class=\"\" target=\"_blank\" href=\"https://developer.spotify.com/dashboard/\">créer un compte développeur sur Spotify</a>.</p><p>Une fois le compte créé, vous avez accès à un <strong>client ID</strong> et <strong>client Secret</strong>.</p><p>Ensuite, ajoutez votre site (ex: http://localhost:3000/) et l&#x27;<strong>URL de callback</strong> (ex: http://localhost:3000/callback) dans les settings.</p><p>Ajoutez dans votre code (JavaScript, PHP, Python) un lien (ex: <code>/login</code>) qui redirige vers l&#x27;adresse suivante :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">const CLIENT_ID = &#x27;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#x27;;\nconst REDIRECT_URI = &#x27;http://localhost:3000/callback&#x27;;\n\nconst scope &#x27;user-read-email&#x27;; // Plus d&#x27;infos sur https://spoti.fi/3sp8zZY\nconst state &#x27;f5d587a11cf33f26812ff17bbedb1928&#x27; // une chaine aléatoire de 16 caractères\n\nres.redirect(`https://accounts.spotify.com/authorize?response_type=code&amp;client_id=${CLIENT_ID}&amp;scope=${scope}&amp;redirect_uri=${REDIRECT_URI}&amp;state=${state}`);\n</code></pre></div><p>Une fois que la personne à cliquer sur le lien spotify, cela lui demandera si il accepte de nous fournir ces informations, dans notre cas il s&#x27;agit de l&#x27;email (user-read-email).</p><p>Cela redirigera ensuite la personne sur l&#x27;adresse de callback avec le paramètre <code>code</code>.</p><p>Ce paramètre <code>code</code> nous sert à récupérer le <strong>token d&#x27;accès</strong> pour communiquer avec l&#x27;<a class=\"\" target=\"_blank\" href=\"https://developer.spotify.com/documentation/web-api/reference\">API de spotify</a>.</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">const { code } = req.query;\nconst { CLIENT_ID, CLIENT_SECRET, REDIRECT_URI } = process.env;\n\nconst { access_token: accessToken } = await fetch(&#x27;https://accounts.spotify.com/api/token&#x27;, {\n    method: &#x27;POST&#x27;,\n    headers: {\n        Authorization: `Basic ${Buffer.from(`${CLIENT_ID}:${CLIENT_SECRET}`).toString(&#x27;base64&#x27;)}`,\n        &#x27;Content-Type&#x27;: &#x27;application/x-form-urlencoded&#x27;,\n    },\n    body: new URLSearchParams({\n        code,\n        redirect_uri: REDIRECT_URI,\n        grant_type: &#x27;authorization_code&#x27;,\n    }),\n}).then((r) =&gt; r.json());\n</code></pre></div><p>On peut à présent <a class=\"\" target=\"_blank\" href=\"https://developer.spotify.com/documentation/web-api/reference/#/operations/get-current-users-profile\">récupérer l&#x27;email de l&#x27;utilisateur</a> :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">const { email } = await fetch(&#x27;https://api.spotify.com/v1/me&#x27;, {\n    headers: { Authorization: `Bearer ${accessToken}` },\n}).then((r) =&gt; r.json());\n</code></pre></div><p>PS : Si vous recevez une erreur du type &#x27;User not registered in the Developer Dashboard&#x27;, c&#x27;est que votre application Spotify est encore en <a class=\"\" target=\"_blank\" href=\"https://developer.spotify.com/dashboard/\">Development mode</a>. Vous devez soit faire &quot;REQUEST EXTENSION&quot; pour sortir du mode développement, soit ajouter les utilisateurs manuellement.</p><hr/><p>Références :</p><ul>\n<li><a class=\"\" target=\"_blank\" href=\"https://developer.spotify.com/documentation/web-api/reference\">API de Spotify</a></li>\n<li><a class=\"\" target=\"_blank\" href=\"https://developer.spotify.com/console/\">API de Spotify 2</a></li>\n<li><a class=\"\" target=\"_blank\" href=\"https://developer.spotify.com/documentation/general/guides/authorization/\">Documentation OAuth de spotify</a></li>\n<li><a class=\"\" target=\"_blank\" href=\"https://grafikart.fr/tutoriels/oauth2-php-google-1171\">Grafikart - Comprendre l&#x27;OAUTH 2.0</a></li>\n</ul></div>","isIndex":false,"file":"Créer un système d'authentification OAuth avec spotify.md","fileName":"Créer un système d'authentification OAuth avec spotify","title":"Créer un système d'authentification OAuth avec spotify","comments":true,"permalink":"creer-un-systeme-dauthentification-oauth-avec-spotify","datePublished":"2021-12-26T15:44","dateUpdated":"2021-12-26T15:44","publish":true,"rss":true,"note":"70"},"__N_SSG":true}