{"pageProps":{"source":"<div class=\"space-y-4 whitespace-normal *:first:mt-0 *:last:mb-0\"><p>Je dispose d&#x27;un serveur nodejs avec express et j&#x27;ai besoin d&#x27;autoriser l&#x27;accès à une route uniquement aux adresses IP de mon réseau interne.</p><p>Pour ça, j&#x27;utilise une librairie : <code>express-ipfilter</code> :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">// index.js\n\nimport express from &#x27;express&#x27;;\nimport { IpFilter, IpDeniedError } from &#x27;express-ipfilter&#x27;;\n\nconst app = express();\n\nconst clientIp = (req) =&gt; {\n    return req.headers[&#x27;x-forwarded-for&#x27;] ? (req.headers[&#x27;x-forwarded-for&#x27;]).split(&#x27;,&#x27;)[0] : req.socket.remoteAddress;\n};\n\nconst ips = [&#x27;172.17.0.0/16&#x27;, &#x27;10.10.0.0/16&#x27;, &#x27;127.0.0.1&#x27;, &#x27;::1&#x27;];\n\napp.use(IpFilter(ips, { mode: &#x27;allow&#x27;, detectIp: clientIp }));\n\napp.use((err, req, res, next) =&gt; {\n    if (err instanceof IpDeniedError) {\n        res.status(401);\n        return res.end(&#x27;You shall not pass&#x27;);\n    }\n\n    return next();\n});\n\napp.get(&#x27;/&#x27;, async (req, res) =&gt; {\n    res.end(&#x27;Secure route&#x27;);\n});\n\nexport default app;\n</code></pre></div></div>","isIndex":false,"file":"Express.js.md","fileName":"Express.js","title":"Bloquer les adresse IPs d'un réseau externe avec Express.js","comments":true,"permalink":"bloquer-les-adresse-ips-dun-reseau-externe-avec-expressjs","datePublished":"2021-08-01T21:31","dateUpdated":"2021-08-01T21:31","publish":true,"rss":true,"note":"46"},"__N_SSG":true}