{"pageProps":{"source":"<div class=\"space-y-4 whitespace-normal *:first:mt-0 *:last:mb-0\"><p>Pour sauvegarder des données sous Linux, il existe <a class=\"\" target=\"_blank\" href=\"https://github.com/restic/restic\">restic</a> en tant que logiciel de backups.</p><p>Restic peut sauvegarder des données sur différent backends :</p><ul>\n<li>Buckets S3 (minio, scaleway, AWS, etc...)</li>\n<li>SFTP</li>\n<li>Local</li>\n<li>Etc...</li>\n</ul><p>Chaque fois que vous lancez la commande <code>restic backup</code>, cela créer un nouvel instantané (un &quot;snapshot&quot;) immuable qui est une photographie de l&#x27;état de vos fichiers à ce moment précis.</p><p>Et si vous souhaitez plus de <a class=\"\" target=\"_blank\" href=\"https://rclone.org/#providers\">backends</a> (Nextcloud, Dropbox, OVH, etc...), il est possible de coupler restic avec <a class=\"\" href=\"/rclone\">Rclone</a>.</p>\n<h2>Installation</h2><p>Pour installer restic sous Debian ou Ubuntu :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">apt update &amp;&amp; apt install -y restic\n</code></pre></div><p>Sur Arch Linux :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">sudo pacman -S restic\n</code></pre></div><p>Ou manuellement :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">export RESTIC_VERSION=0.18.1\nwget https://github.com/restic/restic/releases/download/v$RESTIC_VERSION/restic_${RESTIC_VERSION}_linux_amd64.bz2\nbzip2 -d restic_${RESTIC_VERSION}_linux_amd64.bz2\nmv restic_${RESTIC_VERSION}_linux_amd64 /bin/restic\nchmod +x /bin/restic\n</code></pre></div><h2>Lancer une sauvegarde vers un bucket S3</h2><p>Voici un exemple avec une sauvegarde du dossier <code>~/</code> vers un bucket S3 de chez Scaleway :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-txt\"># ~/.aws/credentials\n[default]\naws_access_key_id = &lt;AWS_ACCESS_KEY_ID&gt;\naws_secret_access_key = &lt;AWS_SECRET_ACCESS_KEY&gt;\n</code></pre></div><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">restic -r s3:s3.fr-par.scw.cloud/&lt;bucket_name&gt; init\n</code></pre></div><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">restic -r s3:s3.fr-par.scw.cloud/&lt;bucket_name&gt; backup ~/\n</code></pre></div><p>Il est possible de facilement automatiser la sauvegarde via une tâche cron :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">RESTIC_REPOSITORY=&quot;MY_REPOSITORY&quot; # Exemple: s3:s3.fr-par.scw.cloud/mybucket\nRESTIC_PASSWORD=&quot;MY_PASSWORD&quot;\n\n0 0 * * * restic backup /home/myuser/\n</code></pre></div><h2>Consulter les sauvegardes</h2><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">restic snapshots\n</code></pre></div><h2>Restaurer une sauvegarde</h2><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">restic restore &lt;id&gt; --target &lt;folder&gt;\n</code></pre></div><h2>Restaurer un fichier spécifique</h2><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">restic restore &lt;id&gt; --include &lt;file_path&gt; --target &lt;folder&gt;\n</code></pre></div><h2>Monter une sauvegarde</h2><p>Pour monter une sauvegarde restic sur un dossier :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">restic mount &lt;folder&gt;\n</code></pre></div><h2>Libérer de l&#x27;espace</h2><p>Pour libérer de l&#x27;espace :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">restic forget --keep-within 30d --prune\n# Ou\nrestic forget --keep-within 30d --group-by &quot;paths&quot; --prune # Ignorer le nom de la machine\n</code></pre></div><h2>Mettre à jour restic</h2><p>Pour mettre à jour restic :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">restic self-update\n</code></pre></div><h2>Débloquer l&#x27;accès</h2><p>Si pour une raison ou une autre votre accès est bloqué, exécuter la commande suivante :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">kill &lt;pid&gt;\nrestic unlock\n</code></pre></div><h2>Mettre à jour le mot de passe d&#x27;un repository</h2><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">restic key list\nrestic key add\n</code></pre></div><h2>Connaitre la taille d&#x27;un repository</h2><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">restic stats\n</code></pre></div><h2>Créer une sauvegarde automatique quotidienne</h2><p>Créer un service dans le fichier <code>~/.config/systemd/user/restic.service</code>:</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-txt\">[Unit]\nDescription=Restic Backup\nWants=network-online.target\nAfter=network-online.target\n\n[Service]\nType=oneshot\nExecStart=restic -q backup ${HOME}\n# ExecStartPost=curl -sL https://mywebhook.example.com\nEnvironment=RESTIC_REPOSITORY=s3:example.com/mybucket\nEnvironment=RESTIC_PASSWORD=myp@ssw0rd\nEnvironment=HOME=/home/myuser\nRestart=on-failure\nRestartSec=30\n</code></pre></div><p>Créer un timer dans le fichier <code>~/.config/systemd/user/restic.timer</code>:</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-txt\">[Unit]\nDescription=Daily Restic Backup Timer\n\n[Timer]\nPersistent=true\nOnCalendar=daily\nRandomizedDelaySec=300\n\n[Install]\nWantedBy=timers.target\n</code></pre></div><p>Activez le timer :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">sudo loginctl enable-linger &lt;user&gt;\nreboot\nsystemctl --user daemon-reload\nsystemctl --user enable --now restic.timer\n</code></pre></div></div>","isIndex":false,"file":"Restic.md","fileName":"Restic","title":"Restic","comments":true,"permalink":"restic","datePublished":"2021-05-17T17:32","dateUpdated":"2024-12-04T10:09:00","publish":true,"rss":true,"note":"78"},"__N_SSG":true}