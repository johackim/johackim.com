{"pageProps":{"source":"<div class=\"space-y-4 whitespace-normal *:first:mt-0 *:last:mb-0\"><p>N&#x27;ayant pas envie d&#x27;utiliser une solution propriétaire pour gérer les commentaires de mon blog et d&#x27;envoyer mes données personnelles et les vôtres (adresse IP, nom et e-mail) sur des serveurs aux USA. Je me suis configuré une petite installation de <a class=\"\" target=\"_blank\" href=\"https://posativ.org/isso/\">Isso</a>.</p><p>J&#x27;utilise <a class=\"\" target=\"_blank\" href=\"http://dokku.viewdocs.io/dokku/\"><strong>dokku</strong></a> pour simplifier la création et les potentiels mises à jour de mes applications docker. C&#x27;est pour moi le moyen le plus simple de gérer une infrastructure web sans la complexité des VHOSTS, déploiements, certificats SSL, volumes et links docker, port binding etc...</p><p>PS: Si vous ne souhaitez pas utilisé dokku, vous pouvez simplement utiliser cette commande docker :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">docker run -d --name isso -p 80:80 sheogorath/isso-docker\n</code></pre></div><h2>Installation</h2><p>Première chose à faire on pull une image docker trouvé sur <a class=\"\" target=\"_blank\" href=\"https://hub.docker.com\">https://hub.docker.com</a> et créer une application <strong>dokku</strong>.</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">docker pull sheogorath/isso-docker\ndokku apps:create isso\n</code></pre></div><p>On configure le nom de domaine de l&#x27;application ainsi que l&#x27;URL du blog qui va héberger le système de commentaire :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">dokku domains:set isso isso.mondomaine.fr \ndokku config:set isso ISSO_HOST=https://blog.mondomaine.fr\n</code></pre></div><p>D&#x27;autres paramètres existent, comme <code>ISSO_REQUIRE_EMAIL</code> qui permet de forcer le commentateur d&#x27;entrer une valeur dans le champ email :</p><p>|Name|Default value|Description|\n|----|-------------|-----------|\n|<code>ISSO_HOST</code>|<code>http://example.com</code>|It corresponds with [General] -&gt; host <a class=\"\" target=\"_blank\" href=\"https://posativ.org/isso/docs/configuration/server/#general\">Details</a>|\n|<code>ISSO_NAME</code>|<code>comments.example.com</code>|It corresponds with [General] -&gt; name <a class=\"\" target=\"_blank\" href=\"https://posativ.org/isso/docs/configuration/server/#general\">Details</a>|\n|<code>ISSO_MAX_AGE</code>|<code>30m</code>|It corresponds with [General] -&gt; max-age <a class=\"\" target=\"_blank\" href=\"https://posativ.org/isso/docs/configuration/server/#general\">Details</a>|\n|<code>ISSO_REPLY_TO_SELF</code>|<code>false</code>|It corresponds with [Guard] -&gt; reply-to-self <a class=\"\" target=\"_blank\" href=\"https://posativ.org/isso/docs/configuration/server/#guard\">Details</a>|\n|<code>ISSO_REQUIRE_EMAIL</code>|<code>false</code>|It corresponds with [Guard] -&gt; require-email <a class=\"\" target=\"_blank\" href=\"https://posativ.org/isso/docs/configuration/server/#guard\">Details</a>|\n|<code>ISSO_REQUIRE_AUTHOR</code>|<code>false</code>|It corresponds with [Guard] -&gt; require-author <a class=\"\" target=\"_blank\" href=\"https://posativ.org/isso/docs/configuration/server/#guard\">Details</a>|</p><p>En temps normal, <strong>dokku</strong> relie directement le port 80 du reverse proxy au port 80 de notre container isso grâce à la directive EXPOSE du Dockerfile, ça ne marche pas sur mon environnement, en attendant la résolution de mon <a class=\"\" target=\"_blank\" href=\"https://github.com/dokku/dokku/issues/2970\">issue</a> voici les commandes à exécuter :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">dokku proxy:ports-add isso http:80:80\ndokku proxy:ports-remove isso http:80:5000\n</code></pre></div><p>Après le paramétrage on déploie l&#x27;application isso :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">docker tag sheogorath/isso-docker dokku/isso\ndocker deploy isso\n</code></pre></div><p>Le serveur est maintenant accessible sur <code>http://isso.mondomaine.fr</code>, une erreur 400 bad request apparait c&#x27;est normal, isso acceptent seulement les requêtes envoyées depuis le(s) domaine(s) autorisé(s) via la directive <code>ISSO_HOST</code>.</p><p>Maintenant que le service isso est en ligne, la configuration de la partie client se fait simplement en ajoutant la librairie JavaScript et une balise <code>&lt;section&gt;</code> sur notre blog :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-html\">&lt;script data-isso=&quot;//isso.mondomaine.fr/&quot; src=&quot;//isso.mondomaine.fr/js/embed.min.js&quot;&gt;&lt;/script&gt;\n&lt;section id=&quot;isso-thread&quot;&gt;&lt;/section&gt;\n</code></pre></div><p>D&#x27;autres paramètres que <code>data-isso</code> existent aussi, pour pouvoir afficher les avatars, votes, changer la langue etc... :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-html\">&lt;script data-isso=&quot;/prefix/&quot;\n        data-isso-css=&quot;true&quot;\n        data-isso-lang=&quot;ru&quot;\n        data-isso-reply-to-self=&quot;false&quot;\n        data-isso-require-author=&quot;false&quot;\n        data-isso-require-email=&quot;false&quot;\n        data-isso-max-comments-top=&quot;10&quot;\n        data-isso-max-comments-nested=&quot;5&quot;\n        data-isso-reveal-on-click=&quot;5&quot;\n        data-isso-avatar=&quot;true&quot;\n        data-isso-avatar-bg=&quot;#f0f0f0&quot;\n        data-isso-avatar-fg=&quot;#9abf88 #5698c4 #e279a3 #9163b6 ...&quot;\n        data-isso-vote=&quot;true&quot;\n        data-vote-levels=&quot;&quot;\n        src=&quot;/prefix/js/embed.js&quot;&gt;&lt;/script&gt;\n</code></pre></div><p>Dans le cas de mon blog sous <strong>ghost</strong>, j&#x27;ai simplement édité mon thème Casper en ajoutant les lignes de code ci-dessus dans le fichier <code>post.hbs</code>.</p><h2>Bonus</h2><p>Pour éviter de perdre les commentaires en cas de mise a jour de <strong>isso</strong> on peut <strong>persister les données</strong> de cette façon :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">dokku storage:mount isso /opt/isso:/data\n</code></pre></div><p>Et si l&#x27;on souhaite ajouter un certificat let&#x27;s encrypt une simple commande dokku existe :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">dokku letsencrypt isso\n</code></pre></div><p>Voilà ! Si vous avez des questions, suggestions n&#x27;hésitez pas à les soumettre dans les commentaires ! Bon week-end ;)</p><hr/><p>Références :</p><ul>\n<li>\n<a title=\"Note bientôt disponible\" class=\"!no-underline border-b-2 border-dotted border-cyan-700\" href=\"/soon?title=H%C3%A9bergeur%20web\">Hébergeur web</a>\n\n</li>\n</ul></div>","isIndex":false,"file":"Isso.md","fileName":"Isso","title":"Installation d'une alternative open-source à Disqus","comments":true,"permalink":"installation-alternative-open-source-disqus","datePublished":"2017-11-03T18:00","dateUpdated":"2017-11-03T18:00","description":"N'ayant pas envie d'utiliser une solution propriétaire pour gérer les commentaires de mon blog je me suis configuré une petite installation de Isso via dokku.","publish":true,"rss":true,"aliases":"","note":"93"},"__N_SSG":true}