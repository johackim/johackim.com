{"pageProps":{"source":"<div class=\"space-y-4 whitespace-normal *:first:mt-0 *:last:mb-0\"><p>Si vous souhaitez parser un site internet, il existe <a class=\"\" target=\"_blank\" href=\"https://github.com/puppeteer/puppeteer\">puppeteer</a>.</p><h2>Installation</h2><p>Pour installer puppeteer :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">yarn add -D puppeteer\n</code></pre></div><h2>Prendre un screenshot</h2><p>Voici un exemple de script Node.js pour prendre un screenshot d&#x27;un site internet :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">#!/bin/node\n\nconst puppeteer = require(&#x27;puppeteer&#x27;);\n\n(async () =&gt; {\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  await page.goto(&#x27;https://johackim.com&#x27;);\n  await page.screenshot({ path: &#x27;example.png&#x27; });\n\n  await browser.close();\n})();\n</code></pre></div><h2>Parser l&#x27;URL d&#x27;une vidéo</h2><p>Si la page que vous souhaitez parser dispose d&#x27;un lien video, vous pouvez reprendre son URL :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">const url = await page.$eval(&#x27;video&#x27;, (a) =&gt; a.getAttribute(&#x27;src&#x27;));\n</code></pre></div><p>Et si vous intégrer <code>youtube-dl</code>, vous pouvez enregistrer la vidéo en question :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">await execSync(`youtube-dl -o &quot;${filePath}&quot; -f &#x27;best[ext=mp4]&#x27; ${url}`, { stdio: &#x27;inherit&#x27; });\n</code></pre></div><h2>Vous connecter sur un site automatiquement</h2><p>Vous pouvez vous connecter automatiquement sur un site en remplissant automatiquement les champs <code>email</code> et <code>password</code>, puis sauvegarder le cookie dans un fichier <code>cookie.json</code> :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">await page.focus(&#x27;input#email&#x27;);\nawait page.keyboard.type(email);\n\nawait page.focus(&#x27;input#password&#x27;);\nawait page.keyboard.type(password);\n\nawait page.click(&#x27;.container form button[type=submit]&#x27;);\n\nawait page.waitForSelector(&#x27;.logged-in&#x27;);\n\nconst cookies = await page.cookies();\nawait page.setCookie(...cookies);\n\nfs.writeFileSync(&#x27;cookie.json&#x27;, JSON.stringify(cookies, null, 2));\n</code></pre></div><p>Facultatif : vous pouvez exporter le cookie directement depuis votre navigateur via <a class=\"\" target=\"_blank\" href=\"https://chrome.google.com/webstore/detail/json-for-puppet/nmckokihipjgplolmcmjakknndddifde\">cette extension</a>.</p><p>Pour réutiliser vos cookies dans une autre session Puppeteer :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">const cookieFile = await fs.readFile(&#x27;cookies.json&#x27;);\nconst cookies = JSON.parse(cookieFile);\nawait page.setCookie(...cookies);\n</code></pre></div><h2>Modifier les paramètre du navigateur headless</h2><p>Puppetteer vous permet de modifier les paramètres du navigateur headless. Si vous souhaitez modifier le navigateur ou le header HTTP User-Agent, écrivez les lignes suivantes :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">const browser = await puppeteer.launch({ executablePath: &#x27;/usr/bin/google-chrome-stable&#x27; });\nconst page = await browser.newPage();\nawait page.setUserAgent(&#x27;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4512.0 Safari/537.36&#x27;);\n</code></pre></div><h2>Récupérer le contenu complet d&#x27;une page HTML</h2><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-js\">const html = await page.content();\n// Ou\nconst html = await page.evaluate(() =&gt; document.body.innerHTML);\n</code></pre></div><h2>Debugger</h2><p>Pour débugger, désactivez le mode <code>headless</code> :</p><div class=\"relative group\"><button type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\">Copier</button><pre><code class=\"language-bash\">await puppeteer.launch({ headless: false });\n</code></pre></div><p>Cela vous permettra de visualiser le rendu directement depuis un vrai navigateur.</p></div>","isIndex":false,"file":"Puppeteer.md","fileName":"Puppeteer","title":"Puppeteer","comments":true,"permalink":"puppeteer","datePublished":"2021-06-07T20:36","dateUpdated":"2021-06-07T20:36","publish":true,"rss":true,"note":"77"},"__N_SSG":true}