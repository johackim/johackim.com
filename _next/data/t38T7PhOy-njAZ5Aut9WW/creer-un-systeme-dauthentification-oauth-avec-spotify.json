{"pageProps":{"source":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    hr: \"hr\",\n    li: \"li\",\n    p: \"p\",\n    pre: \"pre\",\n    strong: \"strong\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"Voici comment créer un système d'authentification \", _jsx(_components.a, {\n        href: \"/oauth\",\n        title: \"OAuth\",\n        className: \"not-found\",\n        children: \"OAuth\"\n      }), \" avec Spotify.\"]\n    }), \"\\n\\n\", _jsxs(_components.p, {\n      children: [\"Commencez par \", _jsx(_components.a, {\n        href: \"https://developer.spotify.com/dashboard/\",\n        children: \"créer un compte développeur sur Spotify\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Une fois le compte créé, vous avez accès à un \", _jsx(_components.strong, {\n        children: \"client ID\"\n      }), \" et \", _jsx(_components.strong, {\n        children: \"client Secret\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Ensuite, ajoutez votre site (ex: \", _jsx(_components.a, {\n        href: \"http://localhost:3000/\",\n        children: \"http://localhost:3000/\"\n      }), \") et l'\", _jsx(_components.strong, {\n        children: \"URL de callback\"\n      }), \" (ex: \", _jsx(_components.a, {\n        href: \"http://localhost:3000/callback\",\n        children: \"http://localhost:3000/callback\"\n      }), \") dans les settings.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Ajoutez dans votre code (JavaScript, PHP, Python) un lien (ex: \", _jsx(_components.code, {\n        children: \"/login\"\n      }), \") qui redirige vers l'adresse suivante :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-js\",\n        children: \"const CLIENT_ID = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';\\nconst REDIRECT_URI = 'http://localhost:3000/callback';\\n\\nconst scope 'user-read-email'; // Plus d'infos sur https://spoti.fi/3sp8zZY\\nconst state 'f5d587a11cf33f26812ff17bbedb1928' // une chaine aléatoire de 16 caractères\\n\\nres.redirect(`https://accounts.spotify.com/authorize?response_type=code&client_id=${CLIENT_ID}&scope=${scope}&redirect_uri=${REDIRECT_URI}&state=${state}`);\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Une fois que la personne à cliquer sur le lien spotify, cela lui demandera si il accepte de nous fournir ces informations, dans notre cas il s'agit de l'email (user-read-email).\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Cela redirigera ensuite la personne sur l'adresse de callback avec le paramètre \", _jsx(_components.code, {\n        children: \"code\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Ce paramètre \", _jsx(_components.code, {\n        children: \"code\"\n      }), \" nous sert à récupérer le \", _jsx(_components.strong, {\n        children: \"token d'accès\"\n      }), \" pour communiquer avec l'\", _jsx(_components.a, {\n        href: \"https://developer.spotify.com/documentation/web-api/reference\",\n        children: \"API de spotify\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-js\",\n        children: \"const { code } = req.query;\\nconst { CLIENT_ID, CLIENT_SECRET, REDIRECT_URI } = process.env;\\n\\nconst { access_token: accessToken } = await fetch('https://accounts.spotify.com/api/token', {\\n    method: 'POST',\\n    headers: {\\n        Authorization: `Basic ${Buffer.from(`${CLIENT_ID}:${CLIENT_SECRET}`).toString('base64')}`,\\n        'Content-Type': 'application/x-form-urlencoded',\\n    },\\n    body: new URLSearchParams({\\n        code,\\n        redirect_uri: REDIRECT_URI,\\n        grant_type: 'authorization_code',\\n    }),\\n}).then((r) => r.json());\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"On peut à présent \", _jsx(_components.a, {\n        href: \"https://developer.spotify.com/documentation/web-api/reference/#/operations/get-current-users-profile\",\n        children: \"récupérer l'email de l'utilisateur\"\n      }), \" :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-js\",\n        children: \"const { email } = await fetch('https://api.spotify.com/v1/me', {\\n    headers: { Authorization: `Bearer ${accessToken}` },\\n}).then((r) => r.json());\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"PS : Si vous recevez une erreur du type 'User not registered in the Developer Dashboard', c'est que votre application Spotify est encore en \", _jsx(_components.a, {\n        href: \"https://developer.spotify.com/dashboard/\",\n        children: \"Development mode\"\n      }), \". Vous devez soit faire \\\"REQUEST EXTENSION\\\" pour sortir du mode développement, soit ajouter les utilisateurs manuellement.\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.p, {\n      children: \"Références :\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://developer.spotify.com/documentation/web-api/reference\",\n          children: \"API de Spotify\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://developer.spotify.com/console/\",\n          children: \"API de Spotify 2\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://developer.spotify.com/documentation/general/guides/authorization/\",\n          children: \"Documentation OAuth de spotify\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://grafikart.fr/tutoriels/oauth2-php-google-1171\",\n          children: \"Grafikart - Comprendre l'OAUTH 2.0\"\n        })\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{"datePublished":"2021-12-26T15:44","dateUpdated":"2021-12-26T15:44","permalink":"creer-un-systeme-dauthentification-oauth-avec-spotify","publish":true,"rss":true,"note":70},"scope":{}},"isIndex":false,"file":"Créer un système d'authentification OAuth avec spotify.md","fileName":"Créer un système d'authentification OAuth avec spotify","comments":true,"title":"Créer un système d'authentification OAuth avec spotify","permalink":"creer-un-systeme-dauthentification-oauth-avec-spotify","datePublished":"2021-12-26T15:44","dateUpdated":"2021-12-26T15:44","publish":true,"rss":true,"note":"70"},"__N_SSG":true}