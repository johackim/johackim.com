{"pageProps":{"source":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    h2: \"h2\",\n    li: \"li\",\n    p: \"p\",\n    pre: \"pre\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"Pour sauvegarder des données sous Linux, il existe \", _jsx(_components.a, {\n        href: \"https://github.com/restic/restic\",\n        children: \"restic\"\n      }), \" en tant que logiciel de backups.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Restic peut sauvegarder des données sur différent backends :\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Buckets S3 (minio, scaleway, AWS, etc...)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"SFTP\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Local\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Etc...\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Chaque fois que vous lancez la commande \", _jsx(_components.code, {\n        children: \"restic backup\"\n      }), \", cela créer un nouvel instantané (un \\\"snapshot\\\") immuable qui est une photographie de l'état de vos fichiers à ce moment précis.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Et si vous souhaitez plus de \", _jsx(_components.a, {\n        href: \"https://rclone.org/#providers\",\n        children: \"backends\"\n      }), \" (Nextcloud, Dropbox, OVH, etc...), il est possible de coupler restic avec \", _jsx(_components.a, {\n        href: \"/rclone\",\n        title: \"Rclone\",\n        children: \"Rclone\"\n      }), \".\"]\n    }), \"\\n\\n\", _jsx(_components.h2, {\n      children: \"Installation\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour installer restic sous Debian ou Ubuntu :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"apt update && apt install -y restic\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Sur Arch Linux :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"sudo pacman -S restic\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Ou manuellement :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"export RESTIC_VERSION=0.18.1\\nwget https://github.com/restic/restic/releases/download/v$RESTIC_VERSION/restic_${RESTIC_VERSION}_linux_amd64.bz2\\nbzip2 -d restic_${RESTIC_VERSION}_linux_amd64.bz2\\nmv restic_${RESTIC_VERSION}_linux_amd64 /bin/restic\\nchmod +x /bin/restic\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Lancer une sauvegarde vers un bucket S3\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Voici un exemple avec une sauvegarde du dossier \", _jsx(_components.code, {\n        children: \"~/\"\n      }), \" vers un bucket S3 de chez Scaleway :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-txt\",\n        children: \"# ~/.aws/credentials\\n[default]\\naws_access_key_id = <AWS_ACCESS_KEY_ID>\\naws_secret_access_key = <AWS_SECRET_ACCESS_KEY>\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"restic -r s3:s3.fr-par.scw.cloud/<bucket_name> init\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"restic -r s3:s3.fr-par.scw.cloud/<bucket_name> backup ~/\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Il est possible de facilement automatiser la sauvegarde via une tâche cron :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"RESTIC_REPOSITORY=\\\"MY_REPOSITORY\\\" # Exemple: s3:s3.fr-par.scw.cloud/mybucket\\nRESTIC_PASSWORD=\\\"MY_PASSWORD\\\"\\n\\n0 0 * * * restic backup /home/myuser/\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Consulter les sauvegardes\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"restic snapshots\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Restaurer une sauvegarde\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"restic restore <id> --target <folder>\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Restaurer un fichier spécifique\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"restic restore <id> --include <file_path> --target <folder>\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Monter une sauvegarde\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour monter une sauvegarde restic sur un dossier :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"restic mount <folder>\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Libérer de l'espace\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour libérer de l'espace :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"restic forget --keep-within 30d --prune\\n# Ou\\nrestic forget --keep-within 30d --group-by \\\"paths\\\" --prune # Ignorer le nom de la machine\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Mettre à jour restic\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour mettre à jour restic :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"restic self-update\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Débloquer l'accès\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Si pour une raison ou une autre votre accès est bloqué, exécuter la commande suivante :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"kill <pid>\\nrestic unlock\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Mettre à jour le mot de passe d'un repository\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"restic key list\\nrestic key add\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Connaitre la taille d'un repository\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"restic stats\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Créer une sauvegarde automatique quotidienne\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Créer un service dans le fichier \", _jsx(_components.code, {\n        children: \"~/.config/systemd/user/restic.service\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-txt\",\n        children: \"[Unit]\\nDescription=Restic Backup\\nWants=network-online.target\\nAfter=network-online.target\\n\\n[Service]\\nType=oneshot\\nExecStart=restic -q backup ${HOME}\\n# ExecStartPost=curl -sL https://mywebhook.example.com\\nEnvironment=RESTIC_REPOSITORY=s3:example.com/mybucket\\nEnvironment=RESTIC_PASSWORD=myp@ssw0rd\\nEnvironment=HOME=/home/myuser\\nRestart=on-failure\\nRestartSec=30\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Créer un timer dans le fichier \", _jsx(_components.code, {\n        children: \"~/.config/systemd/user/restic.timer\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-txt\",\n        children: \"[Unit]\\nDescription=Daily Restic Backup Timer\\n\\n[Timer]\\nPersistent=true\\nOnCalendar=daily\\nRandomizedDelaySec=300\\n\\n[Install]\\nWantedBy=timers.target\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Activez le timer :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"sudo loginctl enable-linger <user>\\nreboot\\nsystemctl --user daemon-reload\\nsystemctl --user enable --now restic.timer\\n\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{"title":"Restic","permalink":"restic","datePublished":"2021-05-17T17:32","dateUpdated":"2024-12-04T10:09:00","publish":true,"rss":true,"note":78},"scope":{}},"isIndex":false,"file":"Restic.md","fileName":"Restic","title":"Restic","comments":true,"permalink":"restic","datePublished":"2021-05-17T17:32","dateUpdated":"2024-12-04T10:09:00","publish":true,"rss":true,"note":"78"},"__N_SSG":true}