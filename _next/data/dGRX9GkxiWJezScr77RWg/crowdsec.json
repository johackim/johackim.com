{"pageProps":{"source":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    blockquote: \"blockquote\",\n    code: \"code\",\n    div: \"div\",\n    em: \"em\",\n    h2: \"h2\",\n    hr: \"hr\",\n    li: \"li\",\n    line: \"line\",\n    ol: \"ol\",\n    p: \"p\",\n    path: \"path\",\n    pre: \"pre\",\n    strong: \"strong\",\n    svg: \"svg\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [_jsx(_components.a, {\n        href: \"https://github.com/crowdsecurity/crowdsec\",\n        children: \"CrowdSec\"\n      }), \" est un \", _jsx(_components.a, {\n        href: \"/pare-feu\",\n        title: \"Pare-feu\",\n        children: \"Pare-feu\"\n      }), \" communautaire open-source pour se prot√©ger des attaques informatiques.\"]\n    }), \"\\n\\n\", _jsx(_components.p, {\n      children: \"Il analyse le comportement des visiteurs via les logs et r√©pond de mani√®re adapt√©e :\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Bloquer l'adresse IP\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Ajouter un captcha\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Ajouter un code HTTP 403\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"ect...\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Les adresses IP agressives sont envoy√©es √† CrowdSec pour √™tre partag√©s entre tous les utilisateurs afin d'am√©liorer la s√©curit√© de chacun.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Installation\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Pour l'installer sur \", _jsx(_components.strong, {\n        children: \"Ubuntu\"\n      }), \" ou \", _jsx(_components.strong, {\n        children: \"Debian\"\n      }), \" :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"curl -s https://install.crowdsec.net | sudo sh\\nsudo apt install -y crowdsec\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Pour l'installer sur \", _jsx(_components.strong, {\n        children: \"Arch Linux\"\n      }), \" :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"yay -S --noconfirm crowdsec-bin\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Pour les autres syst√®mes, \", _jsx(_components.a, {\n        href: \"https://doc.crowdsec.net/docs/getting_started/install_crowdsec/\",\n        children: \"voir la documentation\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"D√©sinstallation\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour le d√©sinstaller :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"sudo apt purge -y crowdsec crowdsec-firewall-bouncer-iptables\\nsudo apt autoremove -y\\nsudo rm -rf /usr/share/crowdsec/ /etc/crowdsec/\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Initialisation\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour d√©marrer CrowdSec, il faut d√©marrer le service :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"sudo systemctl enable --now crowdsec\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Par d√©faut, crowdsec ne fait que lire les logs et afficher des \", _jsx(_components.em, {\n        children: \"alertes\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Pour r√©ellement bloquer les adresses IP suite √† une \", _jsx(_components.em, {\n        children: \"d√©cision\"\n      }), \", il faut installer le \", _jsx(_components.em, {\n        children: \"bouncer\"\n      }), \" iptables :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"apt install -y crowdsec-firewall-bouncer-iptables # Ubuntu/Debian\\n# Ou\\nyay -S --noconfirm crowdsec-firewall-bouncer-iptables # Arch Linux\\n\\n# D√©marrer le service\\nsudo systemctl enable --now crowdsec-firewall-bouncer\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Bannir une adresse IP\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour bannir une adresse IP, voici la commande :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"cscli decisions add -t ban -i <IP>\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Ou une plage d'adresse IPs :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"cscli decisions add -t ban -r <CIDR>\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Il n'est pas possible de bannir une IP d√©finitivement, mais vous pouvez utiliser le param√®tre \", _jsx(_components.code, {\n        children: \"-d 999999h\"\n      }), \" pour mettre une dur√©e de +100ans.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Lister les alertes\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Vous pouvez lister les attaques d√©tect√©es par CrowdSec :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"cscli alerts list\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Et les inspecter plus en d√©tail :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"cscli alerts inspect -d <id>\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Console de CrowdSec\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Et si vous souhaitez relier votre serveur √† la Console de CrowdSec (facultatif) :\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Inscrivez-vous gratuitement sur \", _jsx(_components.a, {\n          href: \"https://app.crowdsec.net/signup\",\n          children: \"https://app.crowdsec.net/signup\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Ex√©cuter la commande \", _jsx(_components.code, {\n          children: \"cscli console enroll <key>\"\n        }), \" (la cl√© est affich√©e sur \", _jsx(_components.a, {\n          href: \"https://app.crowdsec.net/security-engines\",\n          children: \"https://app.crowdsec.net/security-engines\"\n        }), \")\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Cela vous permettra d'ajouter des blocklists facilement.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Ajouter une blocklist manuellement\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Le plus simple pour ajouter une blocklist, c'est de passer par la [[#Console de CrowdSec|console]].\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Mais il est possible d'importer manuellement une blocklist (ex: \", _jsx(_components.a, {\n        href: \"https://github.com/firehol/blocklist-ipsets/\",\n        children: \"https://github.com/firehol/blocklist-ipsets/\"\n      }), \") :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"for ip in $(cat blocklist.txt); do cscli decisions add -t ban -i \\\"$ip\\\"; done\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Ajouter une whitelist manuellement\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Et si vous souhaitez whitelister des IPs (ex: \", _jsx(_components.a, {\n        href: \"https://api.github.com/meta\",\n        children: \"les IPs de Github\"\n      }), \"), √©ditez le fichier \", _jsx(_components.code, {\n        children: \"/etc/crowdsec/parsers/s02-enrich/whitelists.yaml\"\n      }), \" et relancez le service crowdsec.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Vous pouvez aussi cr√©er un fichier \", _jsx(_components.code, {\n        children: \"/etc/crowdsec/parsers/s02-enrich/custom-whitelist.yaml\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Exemple :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-yml\",\n        children: \"name: custom/zammad-whitelist\\ndescription: \\\"Whitelist traffic\\\"\\nwhitelist:\\n  reason: \\\"Legitimate traffic\\\"\\n  expression:\\n    - evt.Line.Raw contains 'zammad'\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Pour v√©rifiez que votre whitelist est bien pris en compte, vous pouvez ex√©cuter un \", _jsx(_components.code, {\n        children: \"cscli metrics | grep whitelist\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Cr√©ez le fichier \", _jsx(_components.code, {\n        children: \"/etc/crowdsec/postoverflows/s01-whitelist/custom-whitelist.yaml\"\n      }), \" si vous souhaitez l'appliquer uniquement pour un scenario sp√©cifique :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-yml\",\n        children: \"name: custom/zammad-whitelist\\ndescription: \\\"Whitelist traffic\\\"\\nfilter: \\\"evt.Overflow.Alert.Scenario == 'custom/http-crawl-non_statics'\\\"\\nwhitelist:\\n  reason: \\\"Legitimate traffic\\\"\\n  expression:\\n    - evt.Line.Raw contains 'zammad'\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Vous pouvez v√©rifier que votre postoverflow existe bien avec \", _jsx(_components.code, {\n        children: \"cscli postoverflows list\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Voir l'√©tat de CrowdSec\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour avoir un visuel de l'√©tat de crowdsec :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"cscli metrics\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Supprimer les faux positifs\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Si vous rencontrez un faux positif, vous pouvez modifier les seuils de tol√©rance :\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Identifier la raison du bannissement avec \", _jsx(_components.code, {\n          children: \"cscli alerts inspect -d <id>\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Ajuster le \", _jsx(_components.code, {\n          children: \"leakspeed\"\n        }), \" (vitesse d'oubli des erreurs), \", _jsx(_components.code, {\n          children: \"capacity\"\n        }), \" (nombre d'erreurs avant ban) ou \", _jsx(_components.code, {\n          children: \"filter\"\n        }), \" du scenario\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"(facultatif) Ou supprimer le scenario en question via \", _jsx(_components.code, {\n          children: \"cscli decisions remove --scenario <scenario>\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Puis red√©marrez avec \", _jsx(_components.code, {\n          children: \"systemctl restart crowdsec\"\n        }), \" ou \", _jsx(_components.code, {\n          children: \"kill -1 1\"\n        }), \" (si docker)\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"D√©sactiver le ban manuellement avec \", _jsx(_components.code, {\n          children: \"cscli decisions remove --id <id>\"\n        })]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Par exemple, j'ai supprim√© le lien symbolique \", _jsx(_components.code, {\n        children: \"/etc/crowdsec/scenarios/http-generic-bf.yaml\"\n      }), \" et j'ai cr√©er un nouveau fichier \", _jsx(_components.code, {\n        children: \"/etc/crowdsec/scenarios/http-generic-bf-custom.yaml\"\n      }), \" avec les valeurs suivantes :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-diff\",\n        children: \"--- /etc/crowdsec/hub/scenarios/crowdsecurity/http-generic-bf.yaml\\n+++ /etc/crowdsec/scenarios/http-generic-bf-custom.yaml\\n@@ -21,12 +21,12 @@\\n # Generic 401 Authorization Errors\\n type: leaky\\n #debug: true\\n-name: LePresidente/http-generic-401-bf\\n+name: custom/http-generic-401-bf\\n description: \\\"Detect generic 401 Authorization error brute force\\\"\\n filter: \\\"evt.Meta.log_type == 'http_access-log' && evt.Parsed.verb == 'POST' && evt.Meta.http_status == '401'\\\"\\n groupby: evt.Meta.source_ip\\n-capacity: 5\\n-leakspeed: \\\"10s\\\"\\n+capacity: 10\\n+leakspeed: \\\"5s\\\"\\n blackhole: 1m\\n labels:\\n   confidence: 3\\n@@ -41,12 +41,12 @@\\n # Generic 403 Forbidden (Authorization) Errors\\n type: leaky\\n #debug: true\\n-name: LePresidente/http-generic-403-bf\\n+name: custom/http-generic-403-bf\\n description: \\\"Detect generic 403 Forbidden (Authorization) error brute force\\\"\\n filter: \\\"evt.Meta.log_type == 'http_access-log' && evt.Parsed.verb == 'POST' && evt.Meta.http_status == '403'\\\"\\n groupby: evt.Meta.source_ip\\n-capacity: 5\\n-leakspeed: \\\"10s\\\"\\n+capacity: 10\\n+leakspeed: \\\"5s\\\"\\n blackhole: 1m\\n labels:\\n   confidence: 3\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Pareil pour le scenario \", _jsx(_components.code, {\n        children: \"http-crawl-non_statics\"\n      }), \" :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-diff\",\n        children: \"--- /etc/crowdsec/hub/scenarios/crowdsecurity/http-crawl-non_statics.yaml\\n+++ /etc/crowdsec/scenarios/http-crawl-non_statics-custom.yaml\\n@@ -1,10 +1,10 @@\\n type: leaky\\n-name: crowdsecurity/http-crawl-non_statics\\n+name: custom/http-crawl-non_statics\\n description: \\\"Detect aggressive crawl on non static resources\\\"\\n filter: \\\"evt.Meta.log_type in ['http_access-log', 'http_error-log'] && evt.Parsed.static_ressource == 'false' && evt.Parsed.verb in ['GET', 'HEAD']\\\"\\n distinct: \\\"evt.Parsed.file_name\\\"\\n-leakspeed: 0.5s\\n-capacity: 40\\n+leakspeed: 0.2s\\n+capacity: 100\\n #debug: true\\n #this limits the memory cache (and event_sequences in output) to five events\\n cache_size: 5\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Vos nouveaux scenarios devraient apparaitre dans le retour de la commande suivante :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"cscli metrics | grep custom\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Cr√©ation d'un scenario personnalis√©\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Cr√©er un fichier (ex: \", _jsx(_components.code, {\n        children: \"http-socketio-flood.yaml\"\n      }), \") dans le dossier \", _jsx(_components.code, {\n        children: \"/etc/crowdsec/scenarios/\"\n      }), \" avec le contenu suivant :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-yaml\",\n        children: \"type: leaky\\nname: custom/socketio-flood\\ndescription: \\\"Detect Socket.IO polling flood\\\"\\nfilter: \\\"evt.Meta.log_type in ['http_access-log', 'http_request'] && evt.Parsed.request contains '/socket.io/'\\\"\\ngroupby: \\\"evt.Meta.source_ip\\\"\\ncapacity: 40\\nleakspeed: \\\"1s\\\"\\nblackhole: 1m\\nlabels:\\n service: http\\n type: dos\\n remediation: true\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Ne pas √©diter les fichiers dans le dossier \", _jsx(_components.code, {\n        children: \"/etc/crowdsec/hub/scenarios/crowdsecurity/\"\n      }), \" car chaque modification peut √™tre √©craser par un simple \", _jsx(_components.code, {\n        children: \"cscli hub update\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Tester la s√©curit√© de son serveur\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour v√©rifier si votre configuration de crowdsec fonctionne correctement vous pouvez simuler des attaques.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Par exemple, simuler des tentatives de connexion SSH √©chou√©es :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"for i in {1..10}; do ssh fakeuser@<IP_ADDRESS>; done\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Ou pour tester la s√©curit√© de votre serveur HTTP(S) :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"for i in {1..50}; do curl -s \\\"https://example.com/non-existent-page-$i\\\"; done\\n# Ou\\nnikto -host https://example.com\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      className: \"callout note\",\n      children: [\"\\n                    \\n                        \", _jsxs(_components.div, {\n        className: \"callout-title\",\n        children: [\"\\n                            \", _jsx(_components.div, {\n          className: \"callout-icon\",\n          children: _jsxs(_components.svg, {\n            xmlns: \"http://www.w3.org/2000/svg\",\n            width: \"24\",\n            height: \"24\",\n            viewBox: \"0 0 24 24\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            strokeWidth: \"2\",\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            children: [_jsx(_components.line, {\n              x1: \"18\",\n              y1: \"2\",\n              x2: \"22\",\n              y2: \"6\"\n            }), _jsx(_components.path, {\n              d: \"M7.5 20.5 19 9l-4-4L3.5 16.5 2 22z\"\n            })]\n          })\n        }), \"\\n                            \", _jsx(_components.div, {\n          className: \"callout-title-inner\",\n          children: \"note\"\n        }), \"\\n                        \"]\n      }), \"\\n                    \\n                    \", _jsxs(_components.div, {\n        className: \"callout-content\",\n        children: [\"\\n                        \", _jsx(_components.p, {\n          children: \"Effectuer ce test via une autre adresse IP (ex: via un VPN) pour √©viter d'√™tre bloqu√© üòÖ.\"\n        }), \"\\n                    \"]\n      }), \"\\n                \"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Puis v√©rifiez les d√©cisions de crowdec :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"sudo cscli decisions list\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Si une d√©cision apparait, vous ne devriez plus avoir acc√®s au serveur SSH ou HTTP(S) pendant plusieurs heures.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Utilisation avec Traefik\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour utiliser CrowdSec avec Traefik et Docker Swarm, j'utilise ces 2 stacks docker :\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/ethibox/awesome-stacks/blob/master/stacks/traefik-crowdsec.yml\",\n          children: \"Traefik\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/ethibox/awesome-stacks/blob/master/stacks/crowdsec.yml\",\n          children: \"Crowdsec\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Installation de traefik :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"ACCESSLOG=true MIDDLEWARES=crowdsec-bouncer@file ACME_EMAIL=noreply@example.com docker stack deploy -c <(curl -so - https://raw.githubusercontent.com/ethibox/awesome-stacks/master/stacks/traefik.yml) traefik\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Installation de crowdsec :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"docker stack deploy -c stacks/crowdsec.yml crowdsec\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Une fois install√©, j'ajoute la configuration suivante dans le fichier \", _jsx(_components.code, {\n        children: \"/etc/crowdsec/acquis.d/traefik.yaml\"\n      }), \" √† l'int√©rieur du conteneur Crowdsec :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-txt\",\n        children: \"filenames:\\n  - /var/log/traefik/access.log\\nlabels:\\n  type: traefik\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"J'ajoute un fichier \", _jsx(_components.code, {\n        children: \"dynamic.yml\"\n      }), \" avec le contenu suivant :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"http:\\n  middlewares:\\n    crowdsec-bouncer:\\n      forwardAuth:\\n        address: http://crowdsec_bouncer:8080/api/v1/forwardAuth\\n        trustForwardHeader: true\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Ensuite, je rentre la commande suivante √† l'int√©rieur du conteneur CrowdSec :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"docker exec -it $(docker ps -qf name=crowdsec_crowdsec) cscli bouncers add traefik-bouncer\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      className: \"callout note\",\n      children: [\"\\n                    \\n                        \", _jsxs(_components.div, {\n        className: \"callout-title\",\n        children: [\"\\n                            \", _jsx(_components.div, {\n          className: \"callout-icon\",\n          children: _jsxs(_components.svg, {\n            xmlns: \"http://www.w3.org/2000/svg\",\n            width: \"24\",\n            height: \"24\",\n            viewBox: \"0 0 24 24\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            strokeWidth: \"2\",\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            children: [_jsx(_components.line, {\n              x1: \"18\",\n              y1: \"2\",\n              x2: \"22\",\n              y2: \"6\"\n            }), _jsx(_components.path, {\n              d: \"M7.5 20.5 19 9l-4-4L3.5 16.5 2 22z\"\n            })]\n          })\n        }), \"\\n                            \", _jsx(_components.div, {\n          className: \"callout-title-inner\",\n          children: \"note\"\n        }), \"\\n                        \"]\n      }), \"\\n                    \\n                    \", _jsxs(_components.div, {\n        className: \"callout-content\",\n        children: [\"\\n                        \", _jsx(_components.p, {\n          children: \"Il est possible de devoir ex√©cuter cscli bouncers delete traefik-bouncer avant pour pouvoir r√©cup√©rer la cl√©.\"\n        }), \"\\n                    \"]\n      }), \"\\n                \"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Et je red√©marre la stack docker avec la variable d'environnement \", _jsx(_components.code, {\n        children: \"CROWDSEC_BOUNCER_API_KEY\"\n      }), \" qui contient la cl√© d'api qui s'affiche en sortie de la commande pr√©c√©dente.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Chaque service reli√© √† Traefik sera prot√©g√© par CrowdSec.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Si vous ex√©cutez une commande comme \", _jsx(_components.code, {\n        children: \"dirsearch -u https://example.com\"\n      }), \" sur un de vos sites internet, votre IP sera automatiquement banni pendant 4h.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"J'ai quelques erreur au d√©marrage de traefik :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-txt\",\n        children: \"ERR Error calling http://crowdsec_bouncer:8080/api/v1/forwardAuth error=\\\"Get \\\\\\\"http://crowdsec_bouncer:8080/api/v1/forwardAuth\\\\\\\": context canceled\\\" middlewareName=crowdsec-bouncer@file middlewareType=ForwardAuth\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Mais cela n'emp√™che un bon fonctionnement. Cela semble √™tre des faux positifs.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Je vous conseille d'ajouter une t√¢che cron avec \", _jsx(_components.a, {\n        href: \"/logrotate\",\n        title: \"logrotate\",\n        className: \"not-found\",\n        children: \"logrotate\"\n      }), \" pour limiter la taille des fichiers de log afin d'√©viter de saturer votre stockage :\"]\n    }), \"\\n\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"@daily logrotate -f /etc/logrotate.d/traefik\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Avec la configuration suivante dans le fichier \", _jsx(_components.code, {\n        children: \"/etc/logrotate.d/traefik\"\n      }), \" :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-txt\",\n        children: \"/var/log/traefik/access.log {\\n    rotate 14\\n    missingok\\n    notifempty\\n    create 644 root root\\n    postrotate\\n        docker ps -qf name=traefik_traefik | xargs -r docker kill --signal=\\\"USR1\\\"\\n        docker ps -qf name=crowdsec_crowdsec | xargs -r docker kill --signal=\\\"HUP\\\"\\n    endscript\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Et pour √©viter d'utiliser la collection \", _jsx(_components.code, {\n        children: \"crowdsecurity/sshd\"\n      }), \", vu que cela concerne uniquement traefik, je supprime la collection via la commande suivante :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"cscli collections remove --force crowdsecurity/sshd\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Tester la configuration crowdsec\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Pour √©viter d'avoir le service crowdsec qui plante lors du changement, vous pouvez tester votre configuration avant :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"crowdsec -c /etc/crowdsec/config.yaml -t\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Installer une nouvelle collection\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Si vous avez des bruteforce sur des application sp√©cifique (ex: wordpress), vous pouvez installer des collections :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"cscli collections install crowdsecurity/wordpress\\n# Ou juste un scenario :\\ncscli scenarios install crowdsecurity/http-bf-wordpress_bf_xmlrpc\\n# Ou une liste blanche :\\ncscli parsers install crowdsecurity/nextcloud-whitelist\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Possibilit√© de chercher des collections ou des scenario depuis les pages suivantes :\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://app.crowdsec.net/hub/collections\",\n          children: \"https://app.crowdsec.net/hub/collections\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://app.crowdsec.net/hub/scenarios\",\n          children: \"https://app.crowdsec.net/hub/scenarios\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"D√©bloquer une IP\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"cscli alert list --ip <ip>\\ncscli alert inspect <id>\\ncat /var/log/traefik/access.log | grep <ip>\\n\"\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.p, {\n      children: \"R√©f√©rences :\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://youtu.be/5K7Aj5ya7uI\",\n          children: \"Korben - D√©couverte et installation de Crowdsec\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://docs.crowdsec.net/\",\n          children: \"https://docs.crowdsec.net/\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://crowdsec.net/blog/enhance-docker-compose-security\",\n          children: \"https://crowdsec.net/blog/enhance-docker-compose-security\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://blog.levassb.ovh/post/crowdsec/\",\n          children: \"https://blog.levassb.ovh/post/crowdsec/\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/crowdsecurity/hub/blob/master/collections/crowdsecurity/traefik.yaml\",\n          children: \"https://github.com/crowdsecurity/hub/blob/master/collections/crowdsecurity/traefik.yaml\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/maxlerebourg/crowdsec-bouncer-traefik-plugin\",\n          children: \"https://github.com/maxlerebourg/crowdsec-bouncer-traefik-plugin\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/fbonalair/traefik-crowdsec-bouncer\",\n          children: \"https://github.com/fbonalair/traefik-crowdsec-bouncer\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://app.crowdsec.net/hub/author/crowdsecurity/collections/traefik\",\n          children: \"https://app.crowdsec.net/hub/author/crowdsecurity/collections/traefik\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://blog.stephane-robert.info/docs/securiser/reseaux/crowdsec/\",\n          children: \"https://blog.stephane-robert.info/docs/securiser/reseaux/crowdsec/\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://it-connect.fr/reverse-proxy-traefik-integration-de-crowdsec-pour-bloquer-les-attaques/\",\n          children: \"https://it-connect.fr/reverse-proxy-traefik-integration-de-crowdsec-pour-bloquer-les-attaques/\"\n        })\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{"title":"CrowdSec","permalink":"crowdsec","description":"CrowdSec est un pare-feu communautaire open-source pour se prot√©ger des attaques informatiques.","publish":true,"rss":true,"datePublished":"2024-04-22T10:00:00","dateUpdated":"2025-12-13T10:00:00"},"scope":{}},"isIndex":false,"file":"CrowdSec.md","fileName":"CrowdSec","title":"CrowdSec","comments":true,"permalink":"crowdsec","description":"CrowdSec est un pare-feu communautaire open-source pour se prot√©ger des attaques informatiques.","publish":true,"rss":true,"datePublished":"2024-04-22T10:00:00","dateUpdated":"2025-12-13T10:00:00"},"__N_SSG":true}