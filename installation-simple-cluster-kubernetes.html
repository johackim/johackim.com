<!DOCTYPE html><html lang="fr"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@_johackim" data-next-head=""/><meta name="twitter:creator" content="@_johackim" data-next-head=""/><meta property="og:url" content="https://johackim.com" data-next-head=""/><meta property="og:locale" content="fr_FR" data-next-head=""/><meta property="og:site_name" content="johackim" data-next-head=""/><title data-next-head="">Installation simple d&#x27;un cluster kubernetes | Johackim - Hacker indépendant</title><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Voici deux méthodes pour installer simplement kubernetes. La première est une installation locale avec minikube, et la deuxième je l&#x27;ai réalisé sur mon cluster proxmox avec kubeadm." data-next-head=""/><meta property="og:title" content="Installation simple d&#x27;un cluster kubernetes" data-next-head=""/><meta property="og:description" content="Voici deux méthodes pour installer simplement kubernetes. La première est une installation locale avec minikube, et la deuxième je l&#x27;ai réalisé sur mon cluster proxmox avec kubeadm." data-next-head=""/><meta property="og:type" content="article" data-next-head=""/><meta property="article:published_time" content="2017-11-10T17:52:00.000Z" data-next-head=""/><meta property="article:modified_time" content="2017-11-10T17:52:00.000Z" data-next-head=""/><meta property="og:image" content="https://johackim.com/covers/installation-simple-cluster-kubernetes.jpg" data-next-head=""/><link rel="preload" href="/_next/static/media/47cbc4e2adbc5db9-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/a1ff13823887c96f.css" as="style"/><script type="application/ld+json" data-next-head="">{"@context":"https://schema.org","@type":"article","datePublished":"2017-11-10T17:52:00.000Z","description":"Voici deux méthodes pour installer simplement kubernetes. La première est une installation locale avec minikube, et la deuxième je l&apos;ai réalisé sur mon cluster proxmox avec kubeadm.","mainEntityOfPage":{"@type":"WebPage","@id":"https://johackim.com/installation-simple-cluster-kubernetes"},"headline":"Installation simple d&apos;un cluster kubernetes","image":["https://johackim.com/covers/installation-simple-cluster-kubernetes.jpg"],"dateModified":"2017-11-10T17:52:00.000Z","author":{"@type":"Person","name":"Johackim"}}</script><link rel="stylesheet" href="/_next/static/css/a1ff13823887c96f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-b1e5f14688f9ffe6.js" defer=""></script><script src="/_next/static/chunks/main-d50aa070ebba4b51.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5505c828b8556d55.js" defer=""></script><script src="/_next/static/chunks/92-8aaa74fb1c3ae5c6.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...permalink%5D%5D-04cf9b070610d4d9.js" defer=""></script><script src="/_next/static/_el56_-biNsFWCfXxZnRa/_buildManifest.js" defer=""></script><script src="/_next/static/_el56_-biNsFWCfXxZnRa/_ssgManifest.js" defer=""></script><style id="__jsx-2490803925">html{font-family:'Roboto', 'Roboto Fallback'}</style></head><body><div id="__next"><header class="flex shadow-md inset-x-0 h-16 items-center z-30 text-gray-700 bg-white fixed top-0"><div class="container m-auto flex items-center justify-between flex-wrap px-4 lg:max-w-screen-lg"><a href="/"><div class="flex items-center"><img alt="logo" loading="lazy" width="48" height="48" decoding="async" data-nimg="1" class="rounded-full w-12" style="color:transparent" src="/profile.jpg"/><div class="ml-2"><div class="font-bold leading-none">Johackim</div><div class="text-sm leading-none">Hacker indépendant</div></div></div></a><nav class="grid grid-flow-col gap-4 items-center"><a class="hover:underline hidden md:block" href="/">Accueil</a><a class="hover:underline hidden md:block" href="/articles">Articles</a><a href="/newsletter"><button type="button" class="bg-cyan-700 text-white hover:text-white hover:bg-cyan-800 px-2.5 py-1.5 rounded-md cursor-pointer">S&#x27;abonner</button></a></nav></div></header><main class="lg:max-w-screen-lg m-auto px-4"><div class="bg-cyan-600 h-1 z-30 fixed inset-0" style="width:0%"></div><div class="md:border md:border-gray-200 mt-20"><h1 class="h-64 flex flex-col justify-center relative border-b border-gray-200"><span class="absolute inset-0 bg-gray-100 opacity-80 z-10"></span><span class="transform text-center font-bold px-4 text-4xl text-gray-600 break-words z-20">Installation simple d&#x27;un cluster kubernetes</span></h1><div class="text-xs my-4 md:px-4 text-gray-700"><span>Mis à jour le </span><span>vendredi 10 novembre 2017</span><span> par <a class="underline text-cyan-700" href="/a-propos">johackim</a></span></div><article class="prose break-words prose-a:font-normal prose-a:text-cyan-700 prose-a:break-words marker:text-gray-700 prose-code:font-normal prose-code:break-words prose-inline-code:px-1.5 prose-inline-code:py-0.5 prose-code:whitespace-pre-wrap prose-code:text-xs prose-code:bg-gray-200 prose-code:rounded-md prose-pre:bg-gray-200 prose-pre:text-gray-700 prose-pre:overflow-x-auto max-w-none px-0 py-4 md:p-4 prose-code:before:hidden prose-code:after:hidden prose-mark:bg-gray-300 prose-td:border-gray-300 prose-td:border prose-td:px-4 prose-th:border prose-th:border-gray-300 prose-th:px-4 prose-th:py-2"><p>Vu la popularité du projet (dépôt github le plus discuté avec +350 000 commentaires) et faisant partie du monde des containers, je n&#x27;ai pas pu résister à l&#x27;envie de tester <strong>kubernetes</strong>. Voici deux méthodes pour installer simplement kubernetes. La première est une installation locale avec <a class="" target="_blank" href="https://github.com/kubernetes/minikube">minikube</a>, et la deuxième je l&#x27;ai réalisé sur <a class="" href="/comment-creer-son-datacenter-maison">mon cluster proxmox</a> avec <a class="" target="_blank" href="https://github.com/kubernetes/kubeadm">kubeadm</a>.</p>

<h2>1. Installation de Minikube</h2>
<p><strong>NOTE</strong>: Il est <strong>déconseillé</strong> d&#x27;utiliser <strong><a class="" target="_blank" href="https://github.com/kubernetes/minikube">minikube</a></strong> dans un environnement de production, il s&#x27;agit plus d&#x27;une installation à usage personnel sur son laptop afin de tester kubernetes.</p>
<p>L&#x27;installation est simple, un binaire à télécharger et à exécuter :</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">wget -O /usr/local/bin/minikube https://github.com/kubernetes/minikube/releases/download/v0.23.0/minikube-linux-amd64
chmod +x /usr/local/bin/minikube
</code></pre></div>
<p>Une fois installé on démarre notre cluster kubernetes single node en une seule commande, l&#x27;installation se fera à l&#x27;intérieur d&#x27;une VM, personnellement j&#x27;utilise <strong>virtualbox</strong> :</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">minikube start --vm-driver=virtualbox
</code></pre></div>
<p>On peut déjà jouer avec <strong>kubernetes</strong> et installer un blog ghost par exemple :</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">kubectl run ghost --image=ghost
kubectl expose deployment ghost --type=NodePort --port=80 --target-port=2368
</code></pre></div>
<p>L&#x27;accès à celui-ci peut se faire de cette façon :</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">export IP=$(minikube ip)
export NODE_PORT=$(kubectl get services ghost -o go-template=&#x27;{{(index .spec.ports 0).nodePort}}&#x27;)
curl http://$IP:$NODE_PORT
</code></pre></div>
<h2>2. Installation de Kubeadm</h2>
<p>L&#x27;utilisation de <strong><a class="" target="_blank" href="https://github.com/kubernetes/kubeadm">kubeadm</a></strong> est aussi déconseillée en production car <strong>kubeadm</strong> est encore en <strong>bêta</strong>, mais n&#x27;étant pas un géant du web je me le permets quand même. J&#x27;ai déployé plusieurs VM <strong>Ubuntu 16.04 LTS</strong> sur mon cluster proxmox. Une qui fera office de master et les autres de workers. Sans proxmox vous pouvez très bien créer vos machines via vagrant :</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">vagrant init ubuntu/xenial64
vagrant up
</code></pre></div>
<p>L&#x27;installation des dépendances d&#x27;un noeud kubernetes (master ou worker) devra s&#x27;effectuer comme suit :</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash"># Installation des dépendances d&#x27;un noeud kubernete

apt-get update &amp;&amp; apt-get install -y apt-transport-https docker.io
echo &quot;deb http://apt.kubernetes.io/ kubernetes-xenial main&quot; &gt;&gt; /etc/apt/sources.list.d/kubernetes.list
curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
apt-get update &amp;&amp; apt-get install -y kubelet kubeadm kubernetes-cni
swapoff -a # Kubernetes ne supporte pas le SWAP
</code></pre></div>
<h3>Master node</h3>
<p>Une fois les dépendances installées et le SWAP désactivé sur chacun des noeuds, nous pouvons installer le master :</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">kubeadm init --pod-network-cidr=10.32.0.0/12
</code></pre></div>
<p>Il est possible de gérer notre cluster depuis notre PC avec kubectl, il suffit de copier le fichier <code>/etc/kubernetes/admin.conf</code> accessible sur votre noeud master dans votre répertoire <code>$HOME/.kube/config</code>.</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">scp root@&lt;master ip&gt;:/etc/kubernetes/admin.conf ~/.kube/config
</code></pre></div>
<p>Je suis sur arch linux donc un simple <code>pacaur -S kubectl-bin</code> m&#x27;installe le client, sinon c&#x27;est juste <a class="" target="_blank" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">un binaire a installer</a>.</p>
<p>Pour vérifier le bon fonctionnement on peut faire un petit <code>kubectl version</code> depuis notre PC.</p>
<p>L&#x27;installation d&#x27;un <strong>pod network add-on</strong> est requis, c&#x27;est ce qui va permettre de faire communiquer les <strong>pods</strong> entre eux. Il en existe plusieurs (<a class="" target="_blank" href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network">voici la liste</a>), moi j&#x27;utilise <strong>kube-router</strong>.</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">kubectl apply -f https://raw.githubusercontent.com/cloudnativelabs/kube-router/master/daemonset/kubeadm-kuberouter.yaml
</code></pre></div>
<p>Après quelques secondes le node master devrait être ready (<code>kubectl get nodes</code> pour vérifier).</p>
<h3>Worker nodes</h3>
<p>Pour ajouter d&#x27;autres noeuds à notre cluster c&#x27;est très simple, la commande <code>kubeadm init</code> exécutée précédemment à du vous afficher une commande <code>kubeadm join</code> suivit d&#x27;un token qui devrait ressembler à ça :</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">kubeadm join --token &lt;TOKEN&gt; &lt;IP&gt;
</code></pre></div>
<p>Une fois cette commande exécutée on vérifie encore une fois que le(s) noeud(s) sont correctement ajouté(s) avec <code>kubectl get nodes</code>.</p>
<p>On peut jouer avec notre cluster et par exemple déployer plusieurs replica de nginx :</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">kubectl run ghost --image=nginx
kubectl scale deployment nginx --replicas=4
kubectl expose deployment nginx --type=NodePort --port=80 --target-port=80
export NODE_PORT=$(kubectl get services nginx -o go-template=&#x27;{{(index .spec.ports 0).nodePort}}&#x27;)
curl http://192.168.1.50:$NODE_PORT
</code></pre></div>
<h3>(Optionel) Utiliser seulement un noeud</h3>
<p>Si vous ne voulez pas utiliser d&#x27;autre noeud que le master pour ne pas s&#x27;embêter avec plusieurs VM par exemple c&#x27;est possible :</p>
<div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash"># Allow a single-host cluster
kubectl taint nodes --all node-role.kubernetes.io/master-
</code></pre></div>
<p>PS: Si jamais vous avez tout cassé ^^ et que votre cluster ne fonctionne plus vous pouvez reset votre installation avec un <code>kubeadm reset</code>.</p>
<h2>Conclusion</h2>
<p>Kubernetes facilite l&#x27;utilisation des containers sur des grosses infrastructures et propose une manière simple de faire de l&#x27;auto-scaling. Ça permet de se concentrer sur le développement et l&#x27;amélioration de son application et moins sur la gestion de ses serveurs.</p>
<p>Maintenant il me reste d&#x27;autres outils liés à kubernetes à découvrir comme <a class="" target="_blank" href="https://draft.sh/">draft.sh</a>, <a class="" target="_blank" href="https://helm.sh/">helm.sh</a> et <a class="" target="_blank" href="https://github.com/fission/fission">fission</a></p>
<p>Je n&#x27;ai pas abordé les détails de l&#x27;utilisation de kubernetes, il s&#x27;agit simplement d&#x27;un mini guide d&#x27;installation pour découvrir l&#x27;outil, Si vous souhaitez en savoir davantage sur kubernetes voici quelques ressources qui m&#x27;ont été très utiles sur sa compréhension et son utilisation :</p>
<p>Un <a class="" target="_blank" href="https://kubernetesbootcamp.github.io/kubernetes-bootcamp/">tutoriel interactif</a> très efficace que je conseille à tous. Et ces deux vidéos, la première est théorique et l&#x27;autre est plus accès sur la pratique.</p>
<p>Voilà ! Comme d&#x27;habitude si vous avez des questions, suggestions n&#x27;hésitez pas à les soumettre dans les commentaires ! Bon week-end ;)</p>
<hr/>
<p>Références :</p>
<ul>
<li><a class="" target="_blank" href="https://github.com/johackim/dotfiles/blob/d4a5a8f5e3390acf9e4dcbfe441a6447279e0527/.cheat/kubernetes">Mon aide mémoire des commandes kubernetes</a></li>
<li><a class="" target="_blank" href="https://kubernetes.io/">https://kubernetes.io/</a></li>
<li><a class="" target="_blank" href="https://github.com/ramitsurana/awesome-kubernetes/">https://github.com/ramitsurana/awesome-kubernetes/</a></li>
<li><a class="" target="_blank" href="http://kubernetesbyexample.com/">http://kubernetesbyexample.com/</a></li>
</ul></article><div class="md:px-4"><hr class="border-gray-200 mb-4 mt-8"/><div id="commento"></div></div></div></main><footer class="container m-auto px-4 py-8 flex items-center justify-between flex-wrap lg:max-w-screen-lg text-gray-700"><div><span class="inline-block transform rotate-180">©</span><span class="ml-2">2017-2025</span></div><nav class="grid grid-flow-col gap-2 items-center"><a href="https://x.com/_johackim" aria-label="X" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"></path></svg></a><a href="https://t.me/johackim" aria-label="Telegram" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"></path></svg></a><a href="https://mastodon.ethibox.fr/@johackim" aria-label="Mastodon" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" aria-hidden="true" data-prefix="fab" data-icon="mastodon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg></a><a href="https://github.com/johackim" aria-label="Github" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a href="https://linkedin.com/in/johackim" aria-label="LinkedIn" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a href="mailto:contact+blog@johackim.com" aria-label="Mail" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg></a><a href="/rss.xml" aria-label="RSS" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg></a></nav></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    h2: \"h2\",\n    h3: \"h3\",\n    hr: \"hr\",\n    li: \"li\",\n    p: \"p\",\n    pre: \"pre\",\n    strong: \"strong\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"Vu la popularité du projet (dépôt github le plus discuté avec +350 000 commentaires) et faisant partie du monde des containers, je n'ai pas pu résister à l'envie de tester \", _jsx(_components.strong, {\n        children: \"kubernetes\"\n      }), \". Voici deux méthodes pour installer simplement kubernetes. La première est une installation locale avec \", _jsx(_components.a, {\n        href: \"https://github.com/kubernetes/minikube\",\n        children: \"minikube\"\n      }), \", et la deuxième je l'ai réalisé sur \", _jsx(_components.a, {\n        href: \"/comment-creer-son-datacenter-maison\",\n        title: \"mon cluster proxmox\",\n        children: \"mon cluster proxmox\"\n      }), \" avec \", _jsx(_components.a, {\n        href: \"https://github.com/kubernetes/kubeadm\",\n        children: \"kubeadm\"\n      }), \".\"]\n    }), \"\\n\\n\", _jsx(_components.h2, {\n      children: \"1. Installation de Minikube\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"NOTE\"\n      }), \": Il est \", _jsx(_components.strong, {\n        children: \"déconseillé\"\n      }), \" d'utiliser \", _jsx(_components.strong, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/kubernetes/minikube\",\n          children: \"minikube\"\n        })\n      }), \" dans un environnement de production, il s'agit plus d'une installation à usage personnel sur son laptop afin de tester kubernetes.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"L'installation est simple, un binaire à télécharger et à exécuter :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"wget -O /usr/local/bin/minikube https://github.com/kubernetes/minikube/releases/download/v0.23.0/minikube-linux-amd64\\nchmod +x /usr/local/bin/minikube\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Une fois installé on démarre notre cluster kubernetes single node en une seule commande, l'installation se fera à l'intérieur d'une VM, personnellement j'utilise \", _jsx(_components.strong, {\n        children: \"virtualbox\"\n      }), \" :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"minikube start --vm-driver=virtualbox\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"On peut déjà jouer avec \", _jsx(_components.strong, {\n        children: \"kubernetes\"\n      }), \" et installer un blog ghost par exemple :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"kubectl run ghost --image=ghost\\nkubectl expose deployment ghost --type=NodePort --port=80 --target-port=2368\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"L'accès à celui-ci peut se faire de cette façon :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"export IP=$(minikube ip)\\nexport NODE_PORT=$(kubectl get services ghost -o go-template='{{(index .spec.ports 0).nodePort}}')\\ncurl http://$IP:$NODE_PORT\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"2. Installation de Kubeadm\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"L'utilisation de \", _jsx(_components.strong, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/kubernetes/kubeadm\",\n          children: \"kubeadm\"\n        })\n      }), \" est aussi déconseillée en production car \", _jsx(_components.strong, {\n        children: \"kubeadm\"\n      }), \" est encore en \", _jsx(_components.strong, {\n        children: \"bêta\"\n      }), \", mais n'étant pas un géant du web je me le permets quand même. J'ai déployé plusieurs VM \", _jsx(_components.strong, {\n        children: \"Ubuntu 16.04 LTS\"\n      }), \" sur mon cluster proxmox. Une qui fera office de master et les autres de workers. Sans proxmox vous pouvez très bien créer vos machines via vagrant :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"vagrant init ubuntu/xenial64\\nvagrant up\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"L'installation des dépendances d'un noeud kubernetes (master ou worker) devra s'effectuer comme suit :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"# Installation des dépendances d'un noeud kubernete\\n\\napt-get update \u0026\u0026 apt-get install -y apt-transport-https docker.io\\necho \\\"deb http://apt.kubernetes.io/ kubernetes-xenial main\\\" \u003e\u003e /etc/apt/sources.list.d/kubernetes.list\\ncurl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\\napt-get update \u0026\u0026 apt-get install -y kubelet kubeadm kubernetes-cni\\nswapoff -a # Kubernetes ne supporte pas le SWAP\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Master node\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Une fois les dépendances installées et le SWAP désactivé sur chacun des noeuds, nous pouvons installer le master :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"kubeadm init --pod-network-cidr=10.32.0.0/12\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Il est possible de gérer notre cluster depuis notre PC avec kubectl, il suffit de copier le fichier \", _jsx(_components.code, {\n        children: \"/etc/kubernetes/admin.conf\"\n      }), \" accessible sur votre noeud master dans votre répertoire \", _jsx(_components.code, {\n        children: \"$HOME/.kube/config\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"scp root@\u003cmaster ip\u003e:/etc/kubernetes/admin.conf ~/.kube/config\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Je suis sur arch linux donc un simple \", _jsx(_components.code, {\n        children: \"pacaur -S kubectl-bin\"\n      }), \" m'installe le client, sinon c'est juste \", _jsx(_components.a, {\n        href: \"https://kubernetes.io/docs/tasks/tools/install-kubectl/\",\n        children: \"un binaire a installer\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Pour vérifier le bon fonctionnement on peut faire un petit \", _jsx(_components.code, {\n        children: \"kubectl version\"\n      }), \" depuis notre PC.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"L'installation d'un \", _jsx(_components.strong, {\n        children: \"pod network add-on\"\n      }), \" est requis, c'est ce qui va permettre de faire communiquer les \", _jsx(_components.strong, {\n        children: \"pods\"\n      }), \" entre eux. Il en existe plusieurs (\", _jsx(_components.a, {\n        href: \"https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network\",\n        children: \"voici la liste\"\n      }), \"), moi j'utilise \", _jsx(_components.strong, {\n        children: \"kube-router\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"kubectl apply -f https://raw.githubusercontent.com/cloudnativelabs/kube-router/master/daemonset/kubeadm-kuberouter.yaml\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Après quelques secondes le node master devrait être ready (\", _jsx(_components.code, {\n        children: \"kubectl get nodes\"\n      }), \" pour vérifier).\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Worker nodes\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Pour ajouter d'autres noeuds à notre cluster c'est très simple, la commande \", _jsx(_components.code, {\n        children: \"kubeadm init\"\n      }), \" exécutée précédemment à du vous afficher une commande \", _jsx(_components.code, {\n        children: \"kubeadm join\"\n      }), \" suivit d'un token qui devrait ressembler à ça :\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"kubeadm join --token \u003cTOKEN\u003e \u003cIP\u003e\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Une fois cette commande exécutée on vérifie encore une fois que le(s) noeud(s) sont correctement ajouté(s) avec \", _jsx(_components.code, {\n        children: \"kubectl get nodes\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"On peut jouer avec notre cluster et par exemple déployer plusieurs replica de nginx :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"kubectl run ghost --image=nginx\\nkubectl scale deployment nginx --replicas=4\\nkubectl expose deployment nginx --type=NodePort --port=80 --target-port=80\\nexport NODE_PORT=$(kubectl get services nginx -o go-template='{{(index .spec.ports 0).nodePort}}')\\ncurl http://192.168.1.50:$NODE_PORT\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"(Optionel) Utiliser seulement un noeud\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Si vous ne voulez pas utiliser d'autre noeud que le master pour ne pas s'embêter avec plusieurs VM par exemple c'est possible :\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"# Allow a single-host cluster\\nkubectl taint nodes --all node-role.kubernetes.io/master-\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"PS: Si jamais vous avez tout cassé ^^ et que votre cluster ne fonctionne plus vous pouvez reset votre installation avec un \", _jsx(_components.code, {\n        children: \"kubeadm reset\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Conclusion\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Kubernetes facilite l'utilisation des containers sur des grosses infrastructures et propose une manière simple de faire de l'auto-scaling. Ça permet de se concentrer sur le développement et l'amélioration de son application et moins sur la gestion de ses serveurs.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Maintenant il me reste d'autres outils liés à kubernetes à découvrir comme \", _jsx(_components.a, {\n        href: \"https://draft.sh/\",\n        children: \"draft.sh\"\n      }), \", \", _jsx(_components.a, {\n        href: \"https://helm.sh/\",\n        children: \"helm.sh\"\n      }), \" et \", _jsx(_components.a, {\n        href: \"https://github.com/fission/fission\",\n        children: \"fission\"\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Je n'ai pas abordé les détails de l'utilisation de kubernetes, il s'agit simplement d'un mini guide d'installation pour découvrir l'outil, Si vous souhaitez en savoir davantage sur kubernetes voici quelques ressources qui m'ont été très utiles sur sa compréhension et son utilisation :\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Un \", _jsx(_components.a, {\n        href: \"https://kubernetesbootcamp.github.io/kubernetes-bootcamp/\",\n        children: \"tutoriel interactif\"\n      }), \" très efficace que je conseille à tous. Et ces deux vidéos, la première est théorique et l'autre est plus accès sur la pratique.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Voilà ! Comme d'habitude si vous avez des questions, suggestions n'hésitez pas à les soumettre dans les commentaires ! Bon week-end ;)\"\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.p, {\n      children: \"Références :\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/johackim/dotfiles/blob/d4a5a8f5e3390acf9e4dcbfe441a6447279e0527/.cheat/kubernetes\",\n          children: \"Mon aide mémoire des commandes kubernetes\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://kubernetes.io/\",\n          children: \"https://kubernetes.io/\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/ramitsurana/awesome-kubernetes/\",\n          children: \"https://github.com/ramitsurana/awesome-kubernetes/\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"http://kubernetesbyexample.com/\",\n          children: \"http://kubernetesbyexample.com/\"\n        })\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{"title":"Installation simple d'un cluster kubernetes","permalink":"installation-simple-cluster-kubernetes","datePublished":"2017-11-10T17:52","dateUpdated":"2017-11-10T17:52","description":"Voici deux méthodes pour installer simplement kubernetes. La première est une installation locale avec minikube, et la deuxième je l'ai réalisé sur mon cluster proxmox avec kubeadm.","publish":true,"rss":true},"scope":{}},"isIndex":false,"file":"Installation simple d'un cluster kubernetes.md","fileName":"Installation simple d'un cluster kubernetes","comments":true,"title":"Installation simple d'un cluster kubernetes","permalink":"installation-simple-cluster-kubernetes","datePublished":"2017-11-10T17:52","dateUpdated":"2017-11-10T17:52","description":"Voici deux méthodes pour installer simplement kubernetes. La première est une installation locale avec minikube, et la deuxième je l'ai réalisé sur mon cluster proxmox avec kubeadm.","publish":true,"rss":true},"__N_SSG":true},"page":"/[[...permalink]]","query":{"permalink":["installation-simple-cluster-kubernetes"]},"buildId":"_el56_-biNsFWCfXxZnRa","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>