<!DOCTYPE html><html lang="fr"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@_johackim" data-next-head=""/><meta name="twitter:creator" content="@_johackim" data-next-head=""/><meta property="og:url" content="https://johackim.com" data-next-head=""/><meta property="og:locale" content="fr_FR" data-next-head=""/><meta property="og:site_name" content="johackim" data-next-head=""/><title data-next-head="">Comment créer son datacenter maison (homelab) ? | Johackim - Hacker indépendant</title><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Voici un guide d&#x27;installation d&#x27;un homelab conçu uniquement avec des logiciels open-source afin de vous permettre d&#x27;héberger vos sites internet à la maison !" data-next-head=""/><meta property="og:title" content="Comment créer son datacenter maison (homelab) ?" data-next-head=""/><meta property="og:description" content="Voici un guide d&#x27;installation d&#x27;un homelab conçu uniquement avec des logiciels open-source afin de vous permettre d&#x27;héberger vos sites internet à la maison !" data-next-head=""/><meta property="og:type" content="article" data-next-head=""/><meta property="article:published_time" content="2017-10-27T08:24:00.000Z" data-next-head=""/><meta property="article:modified_time" content="2017-10-27T08:24:00.000Z" data-next-head=""/><meta property="og:image" content="https://johackim.com/covers/comment-creer-son-datacenter-maison.jpg" data-next-head=""/><link rel="preload" href="/_next/static/media/ce62453a442c7f35-s.p.a9507876.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/chunks/8ed76ae3e03c2690.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/8ed76ae3e03c2690.css" data-n-g=""/><noscript data-n-css=""></noscript><script src="/_next/static/chunks/97f1dd4e262d3e45.js" defer=""></script><script src="/_next/static/chunks/8f7fdb01d15a8219.js" defer=""></script><script src="/_next/static/chunks/55735a38717165a8.js" defer=""></script><script src="/_next/static/chunks/a249cebd710f48a2.js" defer=""></script><script src="/_next/static/chunks/turbopack-97de175104240c95.js" defer=""></script><script src="/_next/static/chunks/615902924f16b9ba.js" defer=""></script><script src="/_next/static/chunks/35397db3c735b8cf.js" defer=""></script><script src="/_next/static/chunks/c9f672f0cfe9662d.js" defer=""></script><script src="/_next/static/chunks/turbopack-7d6231749b9d5e15.js" defer=""></script><script src="/_next/static/37kNBSZEarMk2zx1j6Bqx/_ssgManifest.js" defer=""></script><script src="/_next/static/37kNBSZEarMk2zx1j6Bqx/_buildManifest.js" defer=""></script><style id="__jsx-1922640940">html{font-family:'Roboto', 'Roboto Fallback'}</style></head><body><div id="__next"><header class="flex shadow-md inset-x-0 h-16 items-center z-30 text-gray-700 bg-white fixed top-0"><div class="container m-auto flex items-center justify-between flex-wrap px-2 sm:px-4 lg:max-w-screen-lg"><a href="/"><div class="flex items-center"><img alt="logo" loading="lazy" width="48" height="48" decoding="async" data-nimg="1" class="rounded-full w-12" style="color:transparent" src="/profile.jpg"/><div class="ml-2"><div class="font-bold leading-none">Johackim</div><div class="text-sm leading-none">Hacker indépendant</div></div></div></a><nav class="grid grid-flow-col gap-4 items-center"><a class="hover:underline hidden md:block" href="/">Accueil</a><a class="hover:underline md:block" href="/articles">Articles</a><a href="/newsletter"><button type="button" class="bg-cyan-700 text-white hover:text-white hover:bg-cyan-800 px-2.5 py-1.5 rounded-md cursor-pointer">S&#x27;abonner</button></a></nav></div></header><main class="lg:max-w-screen-lg m-auto px-4"><div class="bg-cyan-600 h-1 z-30 fixed inset-0" style="width:0%"></div><script type="application/ld+json" id="article-jsonld-article">{"@context":"https://schema.org","@type":"article","headline":"Comment créer son datacenter maison (homelab) ?","url":"https://johackim.com/comment-creer-son-datacenter-maison","author":{"@type":"Person","name":"Johackim"},"datePublished":"2017-10-27T08:24:00.000Z","dateModified":"2017-10-27T08:24:00.000Z","image":"https://johackim.com/covers/comment-creer-son-datacenter-maison.jpg","description":"Voici un guide d'installation d'un homelab conçu uniquement avec des logiciels open-source afin de vous permettre d'héberger vos sites internet à la maison !"}</script><div class="md:border md:border-gray-200 mt-20"><h1 class="h-64 flex flex-col justify-center relative border-b border-gray-200"><span class="absolute inset-0 bg-gray-100 opacity-80 z-10"></span><span class="transform text-center font-bold px-4 text-4xl text-gray-600 break-words z-20">Comment créer son datacenter maison (homelab) ?</span></h1><div class="text-xs my-4 md:px-4 text-gray-700"><span>Mis à jour le </span><span>vendredi 27 octobre 2017</span><span> par <a class="underline text-cyan-700" href="/a-propos">johackim</a></span></div><article class="prose break-words prose-a:font-normal prose-a:text-cyan-700 prose-a:break-words marker:text-gray-700 prose-code:font-normal prose-code:break-words prose-inline-code:px-1.5 prose-inline-code:py-0.5 prose-code:whitespace-pre-wrap prose-code:text-xs prose-code:bg-gray-200 prose-code:rounded-md prose-pre:bg-gray-200 prose-pre:text-gray-700 prose-pre:overflow-x-auto max-w-none px-0 py-4 md:p-4 prose-code:before:hidden prose-code:after:hidden prose-mark:bg-gray-300 prose-td:border-gray-300 prose-td:border prose-td:px-4 prose-th:border prose-th:border-gray-300 prose-th:px-4 prose-th:py-2 [&amp;_blockquote_.callout-title]:flex [&amp;_blockquote_.callout-title]:gap-2"><link rel="preload" as="image" href="https://i.imgur.com/HPFrm3m.png"/><link rel="preload" as="image" href="https://i.imgur.com/0BtefaD.png"/><div class="space-y-4 whitespace-normal *:first:mt-0 *:last:mb-0"><p>Après plusieurs semaines de recherches et de tests, je souhaite partager avec vous ce guide d&#x27;installation d&#x27;un homelab conçu uniquement avec des logiciels open-source afin de vous permettre d&#x27;héberger vos sites internet à la maison !</p><p>PS: J&#x27;envisage par la suite de créer une solution <strong>homelab</strong> <strong>all-in-one</strong> et <strong>plug&#x27;n play</strong> afin de permettre aux néophytes d&#x27;installer eux-mêmes leur datacenter chez eux sans connaissances particulières. Si vous êtes intéressé par ce projet, n&#x27;hésitez pas à renseigner votre adresse mail <a class="" href="/newsletter">sur ce lien</a> afin d&#x27;être informé de sa sortie.</p><p>Pour le moment voilà à quoi ressemble mon infrastructure maison :</p><p><img src="https://i.imgur.com/HPFrm3m.png" alt="Infrastructure"/></p><p><strong>NOTE</strong> : Je suis chez orange (Sosh plus précisément) et ma livebox ne gère pas le <strong>bridge</strong>, je ne peux donc pas utilisé <strong>pfsense</strong> en tant que routeur, firewall et serveur DHCP. Et je n&#x27;ai pas non plus la possibilité d&#x27;obtenir une <strong>IP publique fixe</strong>. Je referai un article sur <strong>pfsense</strong> lorsque j&#x27;aurai changé de FAI...</p><h2>Prérequis</h2><ul>
<li>Un PC avec une connexion internet fera l&#x27;affaire. (il existe aussi <a class="" target="_blank" href="https://intel.com/content/us/en/products/boards-kits/nuc.html">les mini PC NUC de Intel</a> qui ont l&#x27;air pas mal).</li>
</ul><p>Pour ma part j&#x27;ai utilisé mon vieux <a class="" target="_blank" href="https://framapic.org/QaBdvkTz4snV/OIbeUeFPEL2I.jpg">Sony VAIO VPCF21Z1E</a> en tant que <strong>Serveur Bare-Metal</strong> sur lequel j&#x27;ai installé <strong>proxmox</strong> comme <strong>hyperviseur</strong>. J&#x27;y ai démarré une VM (machine virtuelle) avec le reverse proxy <strong>traefik</strong> pour pouvoir router le trafic entrant sur les VMs correspondantes. Je peux désormais démarrer autant de VMs que je veux dans la limite des capacités de mon ordinateur. Dans le cas où les limites sont proches d&#x27;être dépassé, proxmox permet de faire du clustering et donne la possibilité de lier d&#x27;autres équipements.</p><p>Voici selon moi les avantages et désavantages de l&#x27;utilisation d&#x27;un homelab par rapport à une solution cloud:</p><h2>Les avantages</h2><ul>
<li>Protection de la vie privée</li>
<li>Économies d&#x27;argent</li>
<li>Garder le contrôle de ses données</li>
<li>Pas de restriction ni de dépendance avec un service tiers</li>
<li>Impact écologique moindre</li>
<li>Décentraliser internet</li>
</ul><h2>Les désavantages</h2><ul>
<li>Le bon fonctionnement de votre homelab dépendra de la qualité du réseau / débit de votre connexion internet.</li>
<li>Votre PC doit rester allumé 24h/24</li>
<li>Pas de support, vous êtes seul en tant qu&#x27;administrateur système (if you break it, you fix it)</li>
<li>Vous disposez généralement d&#x27;une seule adresse IP publique qui n&#x27;est pas toujours statique.</li>
</ul><p>Si comme moi vous êtes curieux, bidouilleur, sensible au sujet de la vie privée et que vous souhaitez vous passer des fournisseurs cloud traditionnels comme AWS, OVH, Digital Ocean, Scaleway, Google Cloud Platform et j&#x27;en passe alors vous êtes au bon endroit !</p><h2>Installation de Proxmox</h2><p>Dans un premier temps, vous devez télécharger et copier le fichier .iso depuis le <a class="" target="_blank" href="https://proxmox.com/en/downloads/category/iso-images-pve">site officiel</a> sur une clé USB. De mon côté, j&#x27;utilise <a class="" target="_blank" href="https://etcher.io/">etcher</a> pour créer une clé USB bootable.</p><p>Une fois bootée sur votre ordinateur qui fera office de serveur, l&#x27;installation commence :</p><p>Selectionnez le disque dur de destination (<code>/dev/sda</code> dans mon cas).</p><p>Selectionnez votre timezone et la langue de votre clavier.</p><p>Configurer les paramètres réseau</p><p><img src="https://i.imgur.com/0BtefaD.png" alt="proxmox configuration réseau"/></p><ul>
<li>Reboot</li>
</ul><p>L&#x27;installation est déjà terminée. Vous pouvez accéder à la très jolie UI de proxmox via <a class="" target="_blank" href="https://192.168.1.50:8006">https://192.168.1.50:8006</a> avec l&#x27;identifiant <strong>root</strong> et <strong>votre mot de passe</strong>.</p><p>Vous pouvez déjà créer des VPS (serveurs privés virtuels) à la demande gratuitement et chez vous !</p><p><strong>Bonus</strong>: proxmox fournit un <strong>catalogue de template</strong> avec tout plein de distributions et services à démarrer en quelques clics (gitlab, etherpad, jenkins, piwik, debian, ubuntu, arch, centos etc...). La partie <strong>Backup</strong> vous permet de planifier la sauvegarde de vos VMs sous forme de snapshots.</p><h2>Reverse proxy (traefik) et let&#x27;s encrypt</h2><p>Je dispose d&#x27;une seule adresse IP publique et les services web que je compte déployer sont répartis sur plusieurs machines virtuelles. <strong>traefik</strong> va router le trafic web entrant sur les différentes VMs.</p><p>On créer une VM <strong>traefik</strong> basé sur <strong>debian</strong> puis on autorise l&#x27;accès aux ports <strong>80</strong> et <strong>443</strong> en ajoutant deux règles de <strong>port forwarding</strong> sur notre box internet en direction de notre nouvelle VM.</p><p>L&#x27;installation de <strong>traefik</strong> est très simple, un simple fichier binaire en go à <a class="" target="_blank" href="https://github.com/containous/traefik/releases">télécharger</a> et exécuter.</p><div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">wget -O /usr/local/bin/traefik https://github.com/containous/traefik/releases/download/v1.4.0-rc4/traefik_linux-amd64
chmod + /usr/local/bin/traefik
</code></pre></div><p>Voilà à quoi ressemble ma configuration pour accéder au blog sur lequel vous vous trouvez actuellement :</p><div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-toml"># traefik.toml

defaultEntryPoints = [&quot;http&quot;, &quot;https&quot;]

[entryPoints]

  [entryPoints.http]
  address = &quot;:80&quot;
    [entryPoints.http.redirect]
    entryPoint = &quot;https&quot;
  [entryPoints.https]
  address = &quot;:443&quot;
    [entryPoints.https.tls]

[acme]

email = &quot;contact@johackim.com&quot;
storage = &quot;acme.json&quot;
entryPoint = &quot;https&quot;
onDemand = true

[[acme.domains]]
  main = &quot;johackim.com&quot;

[file]

[backends]
  [backends.blog]
    [backends.blog.servers.server]
    url = &quot;http://192.168.1.5:80&quot;

[frontends]
  [frontends.blog]
  passHostHeader = true
  entrypoints = [&quot;http&quot;, &quot;https&quot;]
  backend = &quot;blog&quot;
    [frontends.blog.routes.route]
    rule = &quot;Host:johackim.com&quot;
</code></pre></div><p>Une simple commande permet de démarrer traefik : <code>traefik -c traefik.toml</code></p><p>L&#x27;avantage de cette configuration c&#x27;est qu&#x27;elle permet d&#x27;automatiser la génération de certificats <strong>let&#x27;s encrypt</strong>.</p><h2>Configuration de DYNDNS</h2><p>Dans le cas où votre FAI ne vous donne pas la possibilité de disposer d&#x27;une IP statique il existe plusieurs méthodes, j&#x27;en connais actuellement deux, la première fonctionne avec <strong>ddclient</strong>:</p><div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">DEBIAN_FRONTEND=noninteractive apt-get install -y ddclient
</code></pre></div><p>Voici un exemple de configuration <strong>ddclient</strong> relié à <strong>OVH</strong> :</p><div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-conf"># /etc/ddclient.conf

protocol=dyndns2
use=web, web=checkip.dyndns.com
server=ovh.com
login=YOUR_LOGIN
password=YOUR_PASSWORD
johackim.com
</code></pre></div><p>La seconde méthode fonctionne avec un simple script shell <strong>dyndns.sh:</strong></p><div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-bash">#!/bin/bash

DYNHOST_USER=&quot;MY_LOGIN&quot;
DYNHOST_PASSWD=&quot;MY_PASSWORD&quot;
DYNHOST_DOMAINS=(mydomain.com mydomain2.com)
OVH_URL=&quot;https://ovh.com/nic/update?system=dyndns&quot;

for DYNHOST_DOMAIN in ${DYNHOST_DOMAINS[@]}; do
    curl --user &quot;$DYNHOST_USER:$DYNHOST_PASSWD&quot; &quot;${OVH_URL}&amp;hostname=${DYNHOST_DOMAIN}&quot;
done

exit $?
</code></pre></div><p>Sans oublié de configurer une tâche cron:</p><div class="relative group"><button type="button" class="invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none">Copier</button><pre><code class="language-cron">*/10 * * * * bash /usr/local/bin/dyndns.sh
</code></pre></div><p>Dans les deux cas il faudra vous créer un identifiant dans la partie <strong>DynHOST</strong> de votre nom de domaine chez OVH.</p><h2>Contourner le loopback de la Livebox</h2><p>Pour ceux qui disposent une livebox et qui aimeraient accéder à leurs services depuis leur réseau local sans être redirigé sur la page d&#x27;accueil de la livebox je les invite à se rendre sur <a class="" target="_blank" href="https://blog.cagedmonster.net/contourner-le-loopback-de-la-livebox/">cet article</a>.</p><h2>Conclusion</h2><p>Bon, ce n’est pas encore un AWS maison, mais pour ceux qui rêvent de pouvoir lancer des VPS simplement et automatiser leurs sauvegardes avec uniquement des logiciels open-source c&#x27;est déjà un très bon début.</p><p>J&#x27;ai migré toute mon infrastructure OVH chez moi et je dois avouer que c&#x27;est très plaisant ! Je peux augmenté la RAM, CPU et la taille des disques de mes VMs très facilement grâce à proxmox et à moindre cout.</p><p>J&#x27;utilise cette infrastructure maison pour démarrer tous mes services, à savoir Taiga, Jenkins, Rocket.Chat, Metabase, Sentry, Gogs, Zabbix, Searx, Wallabag, Piwik et le blog que vous lisez actuellement</p><p>Pour l&#x27;aspect sécurité, à vous d&#x27;installer et paramétrer vos firewalls, IPS, hardening ect...</p><p>Voilà ! Si vous avez des questions, suggestions ou améliorations à apporter pour faciliter le processus d&#x27;installation ou autre, n&#x27;hésitez pas à les soumettre dans les commentaires !</p><hr/><p>Références :</p><ul>
<li><a class="" target="_blank" href="https://blog.zwindler.fr/2017/07/11/deploiment-de-proxmox-ve-5-sur-un-serveur-dedie-part-1/">Déploiement de proxmox ve 5 sur un serveur dédié</a></li>
<li><a class="" target="_blank" href="https://reddit.com/r/homelab/">https://reddit.com/r/homelab/</a></li>
</ul></div></article><div class="md:px-4"><hr class="border-gray-200 mb-4 mt-8"/><div id="commento"></div></div></div></main><footer class="container m-auto px-4 py-8 flex items-center justify-between flex-wrap lg:max-w-screen-lg text-gray-700"><div><span class="inline-block transform rotate-180">©</span><span class="ml-2">2017-2026</span></div><nav class="grid grid-flow-col gap-2 items-center"><a href="https://x.com/_johackim" aria-label="X" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"></path></svg></a><a href="https://t.me/johackim" aria-label="Telegram" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"></path></svg></a><a href="https://mastodon.ethibox.fr/@johackim" aria-label="Mastodon" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg></a><a href="https://github.com/johackim" aria-label="Github" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a href="https://linkedin.com/in/johackim" aria-label="LinkedIn" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a href="mailto:contact+blog@johackim.com" aria-label="Mail" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg></a><a href="/rss.xml" aria-label="RSS" target="_blank" rel="noreferrer"><svg class="h-5 w-5 fill-current hover:text-black" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg></a></nav></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":"\u003clink rel=\"preload\" as=\"image\" href=\"https://i.imgur.com/HPFrm3m.png\"/\u003e\u003clink rel=\"preload\" as=\"image\" href=\"https://i.imgur.com/0BtefaD.png\"/\u003e\u003cdiv class=\"space-y-4 whitespace-normal *:first:mt-0 *:last:mb-0\"\u003e\u003cp\u003eAprès plusieurs semaines de recherches et de tests, je souhaite partager avec vous ce guide d\u0026#x27;installation d\u0026#x27;un homelab conçu uniquement avec des logiciels open-source afin de vous permettre d\u0026#x27;héberger vos sites internet à la maison !\u003c/p\u003e\u003cp\u003ePS: J\u0026#x27;envisage par la suite de créer une solution \u003cstrong\u003ehomelab\u003c/strong\u003e \u003cstrong\u003eall-in-one\u003c/strong\u003e et \u003cstrong\u003eplug\u0026#x27;n play\u003c/strong\u003e afin de permettre aux néophytes d\u0026#x27;installer eux-mêmes leur datacenter chez eux sans connaissances particulières. Si vous êtes intéressé par ce projet, n\u0026#x27;hésitez pas à renseigner votre adresse mail \u003ca class=\"\" href=\"/newsletter\"\u003esur ce lien\u003c/a\u003e afin d\u0026#x27;être informé de sa sortie.\u003c/p\u003e\u003cp\u003ePour le moment voilà à quoi ressemble mon infrastructure maison :\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/HPFrm3m.png\" alt=\"Infrastructure\"/\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eNOTE\u003c/strong\u003e : Je suis chez orange (Sosh plus précisément) et ma livebox ne gère pas le \u003cstrong\u003ebridge\u003c/strong\u003e, je ne peux donc pas utilisé \u003cstrong\u003epfsense\u003c/strong\u003e en tant que routeur, firewall et serveur DHCP. Et je n\u0026#x27;ai pas non plus la possibilité d\u0026#x27;obtenir une \u003cstrong\u003eIP publique fixe\u003c/strong\u003e. Je referai un article sur \u003cstrong\u003epfsense\u003c/strong\u003e lorsque j\u0026#x27;aurai changé de FAI...\u003c/p\u003e\u003ch2\u003ePrérequis\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003eUn PC avec une connexion internet fera l\u0026#x27;affaire. (il existe aussi \u003ca class=\"\" target=\"_blank\" href=\"https://intel.com/content/us/en/products/boards-kits/nuc.html\"\u003eles mini PC NUC de Intel\u003c/a\u003e qui ont l\u0026#x27;air pas mal).\u003c/li\u003e\n\u003c/ul\u003e\u003cp\u003ePour ma part j\u0026#x27;ai utilisé mon vieux \u003ca class=\"\" target=\"_blank\" href=\"https://framapic.org/QaBdvkTz4snV/OIbeUeFPEL2I.jpg\"\u003eSony VAIO VPCF21Z1E\u003c/a\u003e en tant que \u003cstrong\u003eServeur Bare-Metal\u003c/strong\u003e sur lequel j\u0026#x27;ai installé \u003cstrong\u003eproxmox\u003c/strong\u003e comme \u003cstrong\u003ehyperviseur\u003c/strong\u003e. J\u0026#x27;y ai démarré une VM (machine virtuelle) avec le reverse proxy \u003cstrong\u003etraefik\u003c/strong\u003e pour pouvoir router le trafic entrant sur les VMs correspondantes. Je peux désormais démarrer autant de VMs que je veux dans la limite des capacités de mon ordinateur. Dans le cas où les limites sont proches d\u0026#x27;être dépassé, proxmox permet de faire du clustering et donne la possibilité de lier d\u0026#x27;autres équipements.\u003c/p\u003e\u003cp\u003eVoici selon moi les avantages et désavantages de l\u0026#x27;utilisation d\u0026#x27;un homelab par rapport à une solution cloud:\u003c/p\u003e\u003ch2\u003eLes avantages\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003eProtection de la vie privée\u003c/li\u003e\n\u003cli\u003eÉconomies d\u0026#x27;argent\u003c/li\u003e\n\u003cli\u003eGarder le contrôle de ses données\u003c/li\u003e\n\u003cli\u003ePas de restriction ni de dépendance avec un service tiers\u003c/li\u003e\n\u003cli\u003eImpact écologique moindre\u003c/li\u003e\n\u003cli\u003eDécentraliser internet\u003c/li\u003e\n\u003c/ul\u003e\u003ch2\u003eLes désavantages\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003eLe bon fonctionnement de votre homelab dépendra de la qualité du réseau / débit de votre connexion internet.\u003c/li\u003e\n\u003cli\u003eVotre PC doit rester allumé 24h/24\u003c/li\u003e\n\u003cli\u003ePas de support, vous êtes seul en tant qu\u0026#x27;administrateur système (if you break it, you fix it)\u003c/li\u003e\n\u003cli\u003eVous disposez généralement d\u0026#x27;une seule adresse IP publique qui n\u0026#x27;est pas toujours statique.\u003c/li\u003e\n\u003c/ul\u003e\u003cp\u003eSi comme moi vous êtes curieux, bidouilleur, sensible au sujet de la vie privée et que vous souhaitez vous passer des fournisseurs cloud traditionnels comme AWS, OVH, Digital Ocean, Scaleway, Google Cloud Platform et j\u0026#x27;en passe alors vous êtes au bon endroit !\u003c/p\u003e\u003ch2\u003eInstallation de Proxmox\u003c/h2\u003e\u003cp\u003eDans un premier temps, vous devez télécharger et copier le fichier .iso depuis le \u003ca class=\"\" target=\"_blank\" href=\"https://proxmox.com/en/downloads/category/iso-images-pve\"\u003esite officiel\u003c/a\u003e sur une clé USB. De mon côté, j\u0026#x27;utilise \u003ca class=\"\" target=\"_blank\" href=\"https://etcher.io/\"\u003eetcher\u003c/a\u003e pour créer une clé USB bootable.\u003c/p\u003e\u003cp\u003eUne fois bootée sur votre ordinateur qui fera office de serveur, l\u0026#x27;installation commence :\u003c/p\u003e\u003cp\u003eSelectionnez le disque dur de destination (\u003ccode\u003e/dev/sda\u003c/code\u003e dans mon cas).\u003c/p\u003e\u003cp\u003eSelectionnez votre timezone et la langue de votre clavier.\u003c/p\u003e\u003cp\u003eConfigurer les paramètres réseau\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/0BtefaD.png\" alt=\"proxmox configuration réseau\"/\u003e\u003c/p\u003e\u003cul\u003e\n\u003cli\u003eReboot\u003c/li\u003e\n\u003c/ul\u003e\u003cp\u003eL\u0026#x27;installation est déjà terminée. Vous pouvez accéder à la très jolie UI de proxmox via \u003ca class=\"\" target=\"_blank\" href=\"https://192.168.1.50:8006\"\u003ehttps://192.168.1.50:8006\u003c/a\u003e avec l\u0026#x27;identifiant \u003cstrong\u003eroot\u003c/strong\u003e et \u003cstrong\u003evotre mot de passe\u003c/strong\u003e.\u003c/p\u003e\u003cp\u003eVous pouvez déjà créer des VPS (serveurs privés virtuels) à la demande gratuitement et chez vous !\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eBonus\u003c/strong\u003e: proxmox fournit un \u003cstrong\u003ecatalogue de template\u003c/strong\u003e avec tout plein de distributions et services à démarrer en quelques clics (gitlab, etherpad, jenkins, piwik, debian, ubuntu, arch, centos etc...). La partie \u003cstrong\u003eBackup\u003c/strong\u003e vous permet de planifier la sauvegarde de vos VMs sous forme de snapshots.\u003c/p\u003e\u003ch2\u003eReverse proxy (traefik) et let\u0026#x27;s encrypt\u003c/h2\u003e\u003cp\u003eJe dispose d\u0026#x27;une seule adresse IP publique et les services web que je compte déployer sont répartis sur plusieurs machines virtuelles. \u003cstrong\u003etraefik\u003c/strong\u003e va router le trafic web entrant sur les différentes VMs.\u003c/p\u003e\u003cp\u003eOn créer une VM \u003cstrong\u003etraefik\u003c/strong\u003e basé sur \u003cstrong\u003edebian\u003c/strong\u003e puis on autorise l\u0026#x27;accès aux ports \u003cstrong\u003e80\u003c/strong\u003e et \u003cstrong\u003e443\u003c/strong\u003e en ajoutant deux règles de \u003cstrong\u003eport forwarding\u003c/strong\u003e sur notre box internet en direction de notre nouvelle VM.\u003c/p\u003e\u003cp\u003eL\u0026#x27;installation de \u003cstrong\u003etraefik\u003c/strong\u003e est très simple, un simple fichier binaire en go à \u003ca class=\"\" target=\"_blank\" href=\"https://github.com/containous/traefik/releases\"\u003etélécharger\u003c/a\u003e et exécuter.\u003c/p\u003e\u003cdiv class=\"relative group\"\u003e\u003cbutton type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\"\u003eCopier\u003c/button\u003e\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ewget -O /usr/local/bin/traefik https://github.com/containous/traefik/releases/download/v1.4.0-rc4/traefik_linux-amd64\nchmod + /usr/local/bin/traefik\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eVoilà à quoi ressemble ma configuration pour accéder au blog sur lequel vous vous trouvez actuellement :\u003c/p\u003e\u003cdiv class=\"relative group\"\u003e\u003cbutton type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\"\u003eCopier\u003c/button\u003e\u003cpre\u003e\u003ccode class=\"language-toml\"\u003e# traefik.toml\n\ndefaultEntryPoints = [\u0026quot;http\u0026quot;, \u0026quot;https\u0026quot;]\n\n[entryPoints]\n\n  [entryPoints.http]\n  address = \u0026quot;:80\u0026quot;\n    [entryPoints.http.redirect]\n    entryPoint = \u0026quot;https\u0026quot;\n  [entryPoints.https]\n  address = \u0026quot;:443\u0026quot;\n    [entryPoints.https.tls]\n\n[acme]\n\nemail = \u0026quot;contact@johackim.com\u0026quot;\nstorage = \u0026quot;acme.json\u0026quot;\nentryPoint = \u0026quot;https\u0026quot;\nonDemand = true\n\n[[acme.domains]]\n  main = \u0026quot;johackim.com\u0026quot;\n\n[file]\n\n[backends]\n  [backends.blog]\n    [backends.blog.servers.server]\n    url = \u0026quot;http://192.168.1.5:80\u0026quot;\n\n[frontends]\n  [frontends.blog]\n  passHostHeader = true\n  entrypoints = [\u0026quot;http\u0026quot;, \u0026quot;https\u0026quot;]\n  backend = \u0026quot;blog\u0026quot;\n    [frontends.blog.routes.route]\n    rule = \u0026quot;Host:johackim.com\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eUne simple commande permet de démarrer traefik : \u003ccode\u003etraefik -c traefik.toml\u003c/code\u003e\u003c/p\u003e\u003cp\u003eL\u0026#x27;avantage de cette configuration c\u0026#x27;est qu\u0026#x27;elle permet d\u0026#x27;automatiser la génération de certificats \u003cstrong\u003elet\u0026#x27;s encrypt\u003c/strong\u003e.\u003c/p\u003e\u003ch2\u003eConfiguration de DYNDNS\u003c/h2\u003e\u003cp\u003eDans le cas où votre FAI ne vous donne pas la possibilité de disposer d\u0026#x27;une IP statique il existe plusieurs méthodes, j\u0026#x27;en connais actuellement deux, la première fonctionne avec \u003cstrong\u003eddclient\u003c/strong\u003e:\u003c/p\u003e\u003cdiv class=\"relative group\"\u003e\u003cbutton type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\"\u003eCopier\u003c/button\u003e\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eDEBIAN_FRONTEND=noninteractive apt-get install -y ddclient\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eVoici un exemple de configuration \u003cstrong\u003eddclient\u003c/strong\u003e relié à \u003cstrong\u003eOVH\u003c/strong\u003e :\u003c/p\u003e\u003cdiv class=\"relative group\"\u003e\u003cbutton type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\"\u003eCopier\u003c/button\u003e\u003cpre\u003e\u003ccode class=\"language-conf\"\u003e# /etc/ddclient.conf\n\nprotocol=dyndns2\nuse=web, web=checkip.dyndns.com\nserver=ovh.com\nlogin=YOUR_LOGIN\npassword=YOUR_PASSWORD\njohackim.com\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLa seconde méthode fonctionne avec un simple script shell \u003cstrong\u003edyndns.sh:\u003c/strong\u003e\u003c/p\u003e\u003cdiv class=\"relative group\"\u003e\u003cbutton type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\"\u003eCopier\u003c/button\u003e\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e#!/bin/bash\n\nDYNHOST_USER=\u0026quot;MY_LOGIN\u0026quot;\nDYNHOST_PASSWD=\u0026quot;MY_PASSWORD\u0026quot;\nDYNHOST_DOMAINS=(mydomain.com mydomain2.com)\nOVH_URL=\u0026quot;https://ovh.com/nic/update?system=dyndns\u0026quot;\n\nfor DYNHOST_DOMAIN in ${DYNHOST_DOMAINS[@]}; do\n    curl --user \u0026quot;$DYNHOST_USER:$DYNHOST_PASSWD\u0026quot; \u0026quot;${OVH_URL}\u0026amp;hostname=${DYNHOST_DOMAIN}\u0026quot;\ndone\n\nexit $?\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSans oublié de configurer une tâche cron:\u003c/p\u003e\u003cdiv class=\"relative group\"\u003e\u003cbutton type=\"button\" class=\"invisible group-hover:visible absolute top-0 right-0 rounded-md text-xs bg-gray-300 m-3 p-1.5 cursor-pointer leading-none\"\u003eCopier\u003c/button\u003e\u003cpre\u003e\u003ccode class=\"language-cron\"\u003e*/10 * * * * bash /usr/local/bin/dyndns.sh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eDans les deux cas il faudra vous créer un identifiant dans la partie \u003cstrong\u003eDynHOST\u003c/strong\u003e de votre nom de domaine chez OVH.\u003c/p\u003e\u003ch2\u003eContourner le loopback de la Livebox\u003c/h2\u003e\u003cp\u003ePour ceux qui disposent une livebox et qui aimeraient accéder à leurs services depuis leur réseau local sans être redirigé sur la page d\u0026#x27;accueil de la livebox je les invite à se rendre sur \u003ca class=\"\" target=\"_blank\" href=\"https://blog.cagedmonster.net/contourner-le-loopback-de-la-livebox/\"\u003ecet article\u003c/a\u003e.\u003c/p\u003e\u003ch2\u003eConclusion\u003c/h2\u003e\u003cp\u003eBon, ce n’est pas encore un AWS maison, mais pour ceux qui rêvent de pouvoir lancer des VPS simplement et automatiser leurs sauvegardes avec uniquement des logiciels open-source c\u0026#x27;est déjà un très bon début.\u003c/p\u003e\u003cp\u003eJ\u0026#x27;ai migré toute mon infrastructure OVH chez moi et je dois avouer que c\u0026#x27;est très plaisant ! Je peux augmenté la RAM, CPU et la taille des disques de mes VMs très facilement grâce à proxmox et à moindre cout.\u003c/p\u003e\u003cp\u003eJ\u0026#x27;utilise cette infrastructure maison pour démarrer tous mes services, à savoir Taiga, Jenkins, Rocket.Chat, Metabase, Sentry, Gogs, Zabbix, Searx, Wallabag, Piwik et le blog que vous lisez actuellement\u003c/p\u003e\u003cp\u003ePour l\u0026#x27;aspect sécurité, à vous d\u0026#x27;installer et paramétrer vos firewalls, IPS, hardening ect...\u003c/p\u003e\u003cp\u003eVoilà ! Si vous avez des questions, suggestions ou améliorations à apporter pour faciliter le processus d\u0026#x27;installation ou autre, n\u0026#x27;hésitez pas à les soumettre dans les commentaires !\u003c/p\u003e\u003chr/\u003e\u003cp\u003eRéférences :\u003c/p\u003e\u003cul\u003e\n\u003cli\u003e\u003ca class=\"\" target=\"_blank\" href=\"https://blog.zwindler.fr/2017/07/11/deploiment-de-proxmox-ve-5-sur-un-serveur-dedie-part-1/\"\u003eDéploiement de proxmox ve 5 sur un serveur dédié\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca class=\"\" target=\"_blank\" href=\"https://reddit.com/r/homelab/\"\u003ehttps://reddit.com/r/homelab/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\u003c/div\u003e","isIndex":false,"file":"Homelab.md","fileName":"Homelab","title":"Comment créer son datacenter maison (homelab) ?","comments":true,"permalink":"comment-creer-son-datacenter-maison","datePublished":"2017-10-27T08:24","dateUpdated":"2017-10-27T08:24","description":"Voici un guide d'installation d'un homelab conçu uniquement avec des logiciels open-source afin de vous permettre d'héberger vos sites internet à la maison !","publish":true,"rss":true,"aliases":""},"__N_SSG":true},"page":"/[[...permalink]]","query":{"permalink":["comment-creer-son-datacenter-maison"]},"buildId":"37kNBSZEarMk2zx1j6Bqx","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>